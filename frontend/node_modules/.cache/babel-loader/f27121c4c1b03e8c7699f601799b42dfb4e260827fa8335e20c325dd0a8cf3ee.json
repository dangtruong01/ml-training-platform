{"ast":null,"code":"import _objectSpread from\"/Users/truonghaidang/Desktop/open-trainer/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import'./AutoAnnotationInference.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function AutoAnnotationInference(_ref){let{projectId,projectType,trainingStatus}=_ref;const[inferenceState,setInferenceState]=useState({images:[],componentType:'metal plate',confidenceThreshold:0.5,processing:false,results:[],dragActive:false});const[errors,setErrors]=useState({});const acceptedImageTypes=['image/jpeg','image/jpg','image/png'];const handleImagesDrop=e=>{e.preventDefault();setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:false}));const files=Array.from(e.dataTransfer.files);const imageFiles=files.filter(file=>acceptedImageTypes.includes(file.type));if(imageFiles.length!==files.length){setErrors({images:'Some files were not images and were ignored'});}else{setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{images:''}));}setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{images:imageFiles}));};const handleImagesSelect=e=>{const files=Array.from(e.target.files);setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{images:files}));setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{images:''}));};const handleSettingChange=(setting,value)=>{setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{[setting]:value}));};const removeImage=index=>{setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{images:prev.images.filter((_,i)=>i!==index)}));};const runAutoAnnotation=async()=>{if(inferenceState.images.length===0){setErrors({images:'Please select at least one image'});return;}setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{processing:true}));setErrors({});try{const formData=new FormData();// Add images\ninferenceState.images.forEach(image=>{formData.append('images',image);});// Add settings\nformData.append('component_type',inferenceState.componentType);formData.append('confidence_threshold',inferenceState.confidenceThreshold);const response=await fetch(\"/api/auto-annotation/projects/\".concat(projectId,\"/annotate\"),{method:'POST',body:formData});const result=await response.json();if(result.status==='success'){setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{results:result.results,images:[]// Clear images after successful processing\n}));}else{setErrors({annotation:result.message||'Auto-annotation failed'});}}catch(error){console.error('Auto-annotation failed:',error);setErrors({annotation:'Network error. Please try again.'});}finally{setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{processing:false}));}};const downloadResults=()=>{// Create downloadable results\nconst resultsData={project_id:projectId,project_type:projectType,timestamp:new Date().toISOString(),results:inferenceState.results};const dataStr=JSON.stringify(resultsData,null,2);const dataBlob=new Blob([dataStr],{type:'application/json'});const url=URL.createObjectURL(dataBlob);const link=document.createElement('a');link.href=url;link.download=\"auto_annotation_results_\".concat(new Date().toISOString().split('T')[0],\".json\");link.click();URL.revokeObjectURL(url);};const formatFileSize=bytes=>{if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};const canRunInference=trainingStatus==='completed';if(!canRunInference){return/*#__PURE__*/_jsx(\"div\",{className:\"auto-annotation-inference\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"not-ready-state\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"not-ready-icon\",children:\"\\u26A0\\uFE0F\"}),/*#__PURE__*/_jsx(\"h3\",{children:\"Model Not Ready\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Please complete model training before running auto-annotation\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"status-info\",children:[\"Current training status: \",/*#__PURE__*/_jsx(\"strong\",{children:trainingStatus})]})]})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"auto-annotation-inference\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inference-settings\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\u2699\\uFE0F Annotation Settings\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"settings-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"setting-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Component Type\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:inferenceState.componentType,onChange:e=>handleSettingChange('componentType',e.target.value),placeholder:\"e.g., metal plate, circuit board\"}),/*#__PURE__*/_jsx(\"span\",{className:\"setting-help\",children:\"Type of component to detect with GroundingDINO\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"setting-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Confidence Threshold\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"threshold-control\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"range\",value:inferenceState.confidenceThreshold,onChange:e=>handleSettingChange('confidenceThreshold',parseFloat(e.target.value)),min:\"0.1\",max:\"1.0\",step:\"0.1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"threshold-value\",children:inferenceState.confidenceThreshold})]}),/*#__PURE__*/_jsx(\"span\",{className:\"setting-help\",children:\"Minimum confidence for detection\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-upload-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCF8 Upload Images for Annotation\"}),/*#__PURE__*/_jsx(\"div\",{className:\"drop-zone \".concat(inferenceState.dragActive?'active':''),onDrop:handleImagesDrop,onDragOver:e=>e.preventDefault(),onDragEnter:()=>setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:true})),onDragLeave:()=>setInferenceState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:false})),children:/*#__PURE__*/_jsxs(\"div\",{className:\"drop-zone-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"drop-icon\",children:\"\\uD83D\\uDDBC\\uFE0F\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Drag and drop images here, or click to select\"}),/*#__PURE__*/_jsx(\"p\",{className:\"file-types\",children:\"Supported: JPG, JPEG, PNG\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\".jpg,.jpeg,.png\",onChange:handleImagesSelect,className:\"hidden-file-input\"})]})}),errors.images&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errors.images}),inferenceState.images.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"image-preview\",children:[/*#__PURE__*/_jsxs(\"h5\",{children:[\"Selected Images (\",inferenceState.images.length,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-grid\",children:[inferenceState.images.slice(0,8).map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"image-preview-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:URL.createObjectURL(file),alt:\"Preview \".concat(index),onLoad:e=>URL.revokeObjectURL(e.target.src)}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"image-name\",children:file.name}),/*#__PURE__*/_jsx(\"span\",{className:\"image-size\",children:formatFileSize(file.size)})]}),/*#__PURE__*/_jsx(\"button\",{className:\"remove-button\",onClick:()=>removeImage(index),children:\"\\xD7\"})]},index)),inferenceState.images.length>8&&/*#__PURE__*/_jsxs(\"div\",{className:\"more-images\",children:[\"+\",inferenceState.images.length-8,\" more\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"process-section\",children:[errors.annotation&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-banner\",children:[\"\\u274C \",errors.annotation]}),/*#__PURE__*/_jsx(\"button\",{className:\"process-button\",onClick:runAutoAnnotation,disabled:inferenceState.processing||inferenceState.images.length===0,children:inferenceState.processing?'⏳ Processing...':\"\\uD83E\\uDD16 Run \".concat(projectType==='object_detection'?'Object Detection':'Segmentation')}),/*#__PURE__*/_jsx(\"div\",{className:\"process-info\",children:/*#__PURE__*/_jsxs(\"p\",{children:[\"Will process \",inferenceState.images.length,\" images using trained \",projectType==='object_detection'?'YOLO':'SAM2',\" model\"]})})]}),inferenceState.results.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"results-section\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"results-header\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCCA Annotation Results\"}),/*#__PURE__*/_jsx(\"button\",{className:\"download-button\",onClick:downloadResults,children:\"\\uD83D\\uDCBE Download Results\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"results-grid\",children:inferenceState.results.map((result,index)=>{var _result$defect_detect,_result$defect_detect2,_result$defect_masks;return/*#__PURE__*/_jsxs(\"div\",{className:\"result-item\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"result-header\",children:[/*#__PURE__*/_jsx(\"h5\",{children:result.filename}),/*#__PURE__*/_jsxs(\"span\",{className:\"result-status \".concat(result.status),children:[result.status==='success'?'✅':'❌',\" \",result.status]})]}),result.status==='success'?/*#__PURE__*/_jsxs(\"div\",{className:\"result-content\",children:[result.annotated_image_base64&&/*#__PURE__*/_jsx(\"div\",{className:\"annotated-image\",children:/*#__PURE__*/_jsx(\"img\",{src:\"data:image/jpeg;base64,\".concat(result.annotated_image_base64),alt:\"Annotated \".concat(result.filename)})}),/*#__PURE__*/_jsx(\"div\",{className:\"detection-summary\",children:projectType==='object_detection'?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Defects Found:\"}),\" \",((_result$defect_detect=result.defect_detections)===null||_result$defect_detect===void 0?void 0:_result$defect_detect.length)||0,(_result$defect_detect2=result.defect_detections)===null||_result$defect_detect2===void 0?void 0:_result$defect_detect2.map((detection,idx)=>/*#__PURE__*/_jsxs(\"div\",{className:\"detection-item\",children:[detection.class,\": \",(detection.confidence*100).toFixed(1),\"%\"]},idx))]}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Masks Generated:\"}),\" \",((_result$defect_masks=result.defect_masks)===null||_result$defect_masks===void 0?void 0:_result$defect_masks.length)||0]})})]}):/*#__PURE__*/_jsx(\"div\",{className:\"result-error\",children:result.message||'Processing failed'})]},index);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDD04 Auto-Annotation Workflow\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-steps\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"1\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"step-text\",children:[\"GroundingDINO detects \\\"\",inferenceState.componentType,\"\\\" components\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"step-text\",children:\"Crop images to component regions\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"3\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"step-text\",children:[\"Trained \",projectType==='object_detection'?'YOLO':'SAM2',\" model detects defects\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"workflow-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"4\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"step-text\",children:[\"Generate \",projectType==='object_detection'?'bounding boxes':'precise masks',\" and results\"]})]})]})]})]});}export default AutoAnnotationInference;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}