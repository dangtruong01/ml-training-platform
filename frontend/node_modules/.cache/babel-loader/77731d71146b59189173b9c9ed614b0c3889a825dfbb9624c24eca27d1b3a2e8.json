{"ast":null,"code":"import _objectSpread from\"/Users/truonghaidang/Desktop/open-trainer/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState}from'react';import'./TrainingDataUpload.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function TrainingDataUpload(_ref){let{projectId,projectType,onDataUploaded}=_ref;const[uploadState,setUploadState]=useState({images:[],annotations:null,uploading:false,dragActive:false});const[errors,setErrors]=useState({});const acceptedImageTypes=['image/jpeg','image/jpg','image/png'];const acceptedAnnotationTypes=projectType==='object_detection'?['application/zip']:['application/json'];const handleImagesDrop=e=>{e.preventDefault();setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:false}));const files=Array.from(e.dataTransfer.files);const imageFiles=files.filter(file=>acceptedImageTypes.includes(file.type));if(imageFiles.length!==files.length){setErrors({images:'Some files were not images and were ignored'});}else{setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{images:''}));}setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{images:imageFiles}));};const handleImagesSelect=e=>{const files=Array.from(e.target.files);setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{images:files}));setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{images:''}));};const handleAnnotationsSelect=e=>{const file=e.target.files[0];if(file){setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{annotations:file}));setErrors(prev=>_objectSpread(_objectSpread({},prev),{},{annotations:''}));}};const validateUpload=()=>{const newErrors={};if(uploadState.images.length===0){newErrors.images='Please select at least one training image';}setErrors(newErrors);return Object.keys(newErrors).length===0;};const handleUpload=async()=>{if(!validateUpload()){return;}setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{uploading:true}));try{const formData=new FormData();// Add images\nuploadState.images.forEach(image=>{formData.append('training_images',image);});// Add annotations if provided\nif(uploadState.annotations){formData.append('annotations_file',uploadState.annotations);}// Add format\nformData.append('annotation_format','auto');const response=await fetch(\"/api/auto-annotation/projects/\".concat(projectId,\"/upload-training-data\"),{method:'POST',body:formData});const result=await response.json();if(result.status==='success'){// Reset form\nsetUploadState({images:[],annotations:null,uploading:false,dragActive:false});if(onDataUploaded){onDataUploaded();}}else{setErrors({upload:result.message||'Upload failed'});}}catch(error){console.error('Upload failed:',error);setErrors({upload:'Network error. Please try again.'});}finally{setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{uploading:false}));}};const removeImage=index=>{setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{images:prev.images.filter((_,i)=>i!==index)}));};const formatFileSize=bytes=>{if(bytes===0)return'0 Bytes';const k=1024;const sizes=['Bytes','KB','MB','GB'];const i=Math.floor(Math.log(bytes)/Math.log(k));return parseFloat((bytes/Math.pow(k,i)).toFixed(2))+' '+sizes[i];};return/*#__PURE__*/_jsxs(\"div\",{className:\"training-data-upload\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upload-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCF8 Training Images\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"section-description\",children:[\"Upload images that will be used to train your \",projectType==='object_detection'?'YOLO':'SAM2',\" model\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"drop-zone \".concat(uploadState.dragActive?'active':''),onDrop:handleImagesDrop,onDragOver:e=>e.preventDefault(),onDragEnter:()=>setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:true})),onDragLeave:()=>setUploadState(prev=>_objectSpread(_objectSpread({},prev),{},{dragActive:false})),children:/*#__PURE__*/_jsxs(\"div\",{className:\"drop-zone-content\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"drop-icon\",children:\"\\uD83D\\uDCC1\"}),/*#__PURE__*/_jsx(\"p\",{children:\"Drag and drop images here, or click to select\"}),/*#__PURE__*/_jsx(\"p\",{className:\"file-types\",children:\"Supported: JPG, JPEG, PNG\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\".jpg,.jpeg,.png\",onChange:handleImagesSelect,className:\"hidden-file-input\"})]})}),errors.images&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errors.images}),uploadState.images.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"file-preview\",children:[/*#__PURE__*/_jsxs(\"h5\",{children:[\"Selected Images (\",uploadState.images.length,\")\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-grid\",children:[uploadState.images.slice(0,6).map((file,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"image-preview-item\",children:[/*#__PURE__*/_jsx(\"img\",{src:URL.createObjectURL(file),alt:\"Preview \".concat(index),onLoad:e=>URL.revokeObjectURL(e.target.src)}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-info\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"image-name\",children:file.name}),/*#__PURE__*/_jsx(\"span\",{className:\"image-size\",children:formatFileSize(file.size)})]}),/*#__PURE__*/_jsx(\"button\",{className:\"remove-button\",onClick:()=>removeImage(index),children:\"\\xD7\"})]},index)),uploadState.images.length>6&&/*#__PURE__*/_jsxs(\"div\",{className:\"more-images\",children:[\"+\",uploadState.images.length-6,\" more\"]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-section\",children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83C\\uDFF7\\uFE0F Annotations (Optional)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"section-description\",children:projectType==='object_detection'?'Upload YOLO format annotations (ZIP file with .txt files)':'Upload COCO format annotations (JSON file with segmentation data)'}),/*#__PURE__*/_jsxs(\"div\",{className:\"file-input-container\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:projectType==='object_detection'?'.zip':'.json',onChange:handleAnnotationsSelect,className:\"file-input\",id:\"annotations-input\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"annotations-input\",className:\"file-input-label\",children:uploadState.annotations?uploadState.annotations.name:'Choose Annotation File'})]}),errors.annotations&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:errors.annotations}),/*#__PURE__*/_jsxs(\"div\",{className:\"format-info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDCCB Expected Format:\"}),projectType==='object_detection'?/*#__PURE__*/_jsxs(\"div\",{className:\"format-example\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"YOLO Format (.txt files in ZIP):\"})}),/*#__PURE__*/_jsx(\"code\",{children:\"class_id center_x center_y width height\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"format-note\",children:[\"Example: \",/*#__PURE__*/_jsx(\"code\",{children:\"0 0.5 0.3 0.2 0.1\"}),\" (normalized coordinates)\"]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"format-example\",children:[/*#__PURE__*/_jsx(\"p\",{children:/*#__PURE__*/_jsx(\"strong\",{children:\"COCO Format (JSON file):\"})}),/*#__PURE__*/_jsx(\"code\",{children:\"{\\\"annotations\\\": [{\\\"segmentation\\\": [[x1,y1,x2,y2,...]], \\\"bbox\\\": [x,y,w,h]}]}\"}),/*#__PURE__*/_jsx(\"p\",{className:\"format-note\",children:\"Standard COCO JSON with polygon segmentation data\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-actions\",children:[errors.upload&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-banner\",children:[\"\\u274C \",errors.upload]}),/*#__PURE__*/_jsx(\"div\",{className:\"action-buttons\",children:/*#__PURE__*/_jsx(\"button\",{className:\"upload-button\",onClick:handleUpload,disabled:uploadState.uploading||uploadState.images.length===0,children:uploadState.uploading?'‚è≥ Uploading...':'üì§ Upload Training Data'})}),/*#__PURE__*/_jsxs(\"div\",{className:\"upload-summary\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Ready to upload: \",uploadState.images.length,\" images\"]}),uploadState.annotations&&/*#__PURE__*/_jsx(\"span\",{children:\", 1 annotation file\"})]})]})]});}export default TrainingDataUpload;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}