{"ast":null,"code":"var _jsxFileName = \"/Users/truonghaidang/Desktop/open-trainer/frontend/src/components/Annotate.js\";\nimport React, { useState, useEffect } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Annotate() {\n  const [files, setFiles] = useState([]);\n  const [previews, setPreviews] = useState([]);\n  const [annotatedResults, setAnnotatedResults] = useState([]);\n  const [annotationType, setAnnotationType] = useState('detection');\n  const [isLoading, setIsLoading] = useState(false);\n  const [processingProgress, setProcessingProgress] = useState({\n    current: 0,\n    total: 0\n  });\n  const [batchId, setBatchId] = useState(null);\n\n  // GroundingDINO specific state\n  const [groundingDinoPrompts, setGroundingDinoPrompts] = useState('scratch, dent, dirt');\n  const [confidenceThreshold, setConfidenceThreshold] = useState(0.3);\n  const [groundingDinoAvailable, setGroundingDinoAvailable] = useState(false);\n\n  // Guardrail (Anomaly Detection + Classification) specific state\n  const [guardrailModelPath, setGuardrailModelPath] = useState('');\n  const [guardrailPrompts, setGuardrailPrompts] = useState('scratch, dent, dirt');\n  const [guardrailConfidenceThreshold, setGuardrailConfidenceThreshold] = useState(0.3);\n  const [isTrainingAnomalyModel, setIsTrainingAnomalyModel] = useState(false);\n  const [anomalyTrainingFiles, setAnomalyTrainingFiles] = useState([]);\n  const [anomalyProjectName, setAnomalyProjectName] = useState('');\n  const [showAnomalyTraining, setShowAnomalyTraining] = useState(false);\n\n  // Check GroundingDINO availability on component mount\n  useEffect(() => {\n    checkGroundingDinoStatus();\n  }, []);\n  const checkGroundingDinoStatus = async () => {\n    try {\n      const response = await fetch('/grounding-dino-status');\n      const data = await response.json();\n      setGroundingDinoAvailable(data.available);\n    } catch (error) {\n      console.error('Error checking GroundingDINO status:', error);\n      setGroundingDinoAvailable(false);\n    }\n  };\n  const handleFileChange = e => {\n    const selectedFiles = Array.from(e.target.files);\n    setFiles(selectedFiles);\n\n    // Create previews for all selected files\n    const newPreviews = selectedFiles.map(file => ({\n      file,\n      url: URL.createObjectURL(file),\n      name: file.name\n    }));\n    setPreviews(newPreviews);\n    setAnnotatedResults([]); // Reset results when new files are selected\n  };\n  const handleAnnotate = async () => {\n    if (files.length === 0) {\n      alert(\"Please select at least one file first.\");\n      return;\n    }\n    setIsLoading(true);\n    setProcessingProgress({\n      current: 0,\n      total: files.length\n    });\n    setAnnotatedResults([]);\n\n    // Generate unique batch ID\n    const newBatchId = `batch_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n    setBatchId(newBatchId);\n    if (annotationType === 'grounding-dino') {\n      await handleGroundingDinoAnnotation(newBatchId);\n    } else if (annotationType === 'guardrail') {\n      await handleGuardrailAnnotation(newBatchId);\n    } else {\n      await handleTraditionalAnnotation(newBatchId);\n    }\n  };\n  const handleGroundingDinoAnnotation = async newBatchId => {\n    try {\n      const formData = new FormData();\n      files.forEach(file => formData.append('files', file));\n      formData.append('prompts', groundingDinoPrompts);\n      formData.append('confidence_threshold', confidenceThreshold);\n      const response = await fetch('/grounding-dino-batch', {\n        method: 'POST',\n        body: formData\n      });\n      if (response.ok) {\n        const data = await response.json();\n        const results = data.results.map(result => ({\n          originalName: result.filename,\n          success: result.status === 'success',\n          annotatedUrl: result.status === 'success' ? `data:image/jpeg;base64,${result.image_base64}` : null,\n          error: result.status !== 'success' ? result.message : null,\n          detections: result.detections || [],\n          total_detections: result.total_detections || 0,\n          yolo_annotations: result.yolo_annotations\n        }));\n        setAnnotatedResults(results);\n      } else {\n        throw new Error('GroundingDINO batch annotation failed');\n      }\n    } catch (error) {\n      console.error('GroundingDINO annotation error:', error);\n      alert('GroundingDINO annotation failed. Please try again.');\n    } finally {\n      setIsLoading(false);\n      setProcessingProgress({\n        current: 0,\n        total: 0\n      });\n    }\n  };\n  const handleGuardrailAnnotation = async newBatchId => {\n    if (!guardrailModelPath) {\n      alert(\"Please provide the path to your trained anomaly model.\");\n      setIsLoading(false);\n      return;\n    }\n    const results = [];\n    try {\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        setProcessingProgress({\n          current: i + 1,\n          total: files.length\n        });\n        const formData = new FormData();\n        formData.append(\"file\", file);\n        formData.append(\"model_path\", guardrailModelPath);\n        formData.append(\"prompts\", guardrailPrompts);\n        formData.append(\"confidence_threshold\", guardrailConfidenceThreshold);\n        try {\n          const response = await fetch('/annotate-with-guardrail', {\n            method: 'POST',\n            body: formData\n          });\n          if (response.ok) {\n            const data = await response.json();\n            results.push({\n              originalName: file.name,\n              success: data.status === 'success',\n              annotatedUrl: data.status === 'success' && data.annotated_image ? `data:image/jpeg;base64,${btoa(String.fromCharCode(...new Uint8Array(data.annotated_image)))}` : null,\n              error: data.status !== 'success' ? data.message : null,\n              detections: data.detections || [],\n              total_detections: data.detections ? data.detections.length : 0\n            });\n          } else {\n            results.push({\n              originalName: file.name,\n              success: false,\n              error: \"Guardrail annotation failed\"\n            });\n          }\n        } catch (error) {\n          console.error(`Error processing ${file.name}:`, error);\n          results.push({\n            originalName: file.name,\n            success: false,\n            error: \"Processing error\"\n          });\n        }\n      }\n      setAnnotatedResults(results);\n    } catch (error) {\n      console.error('Guardrail annotation error:', error);\n      alert('Guardrail annotation failed. Please try again.');\n    } finally {\n      setIsLoading(false);\n      setProcessingProgress({\n        current: 0,\n        total: 0\n      });\n    }\n  };\n  const handleTraditionalAnnotation = async newBatchId => {\n    const endpointMap = {\n      'detection': '/pre-annotate-detect',\n      'segmentation': '/pre-annotate-segment',\n      'sam2-detection': '/pre-annotate-sam2-detect',\n      'sam2-segmentation': '/pre-annotate-sam2-segment'\n    };\n    const endpoint = endpointMap[annotationType] || '/pre-annotate-detect';\n    const results = [];\n    try {\n      for (let i = 0; i < files.length; i++) {\n        const file = files[i];\n        setProcessingProgress({\n          current: i + 1,\n          total: files.length\n        });\n        const formData = new FormData();\n        formData.append(\"file\", file);\n        formData.append(\"batch_id\", newBatchId); // Add batch ID for caching\n\n        try {\n          const response = await fetch(endpoint, {\n            method: \"POST\",\n            body: formData\n          });\n          if (response.ok) {\n            const imageBlob = await response.blob();\n            results.push({\n              originalName: file.name,\n              annotatedUrl: URL.createObjectURL(imageBlob),\n              success: true\n            });\n          } else {\n            results.push({\n              originalName: file.name,\n              success: false,\n              error: `${annotationType} annotation failed`\n            });\n          }\n        } catch (error) {\n          console.error(`Error processing ${file.name}:`, error);\n          results.push({\n            originalName: file.name,\n            success: false,\n            error: \"Processing error\"\n          });\n        }\n      }\n      setAnnotatedResults(results);\n    } catch (error) {\n      console.error(\"Error during batch annotation:\", error);\n      alert(\"An error occurred during batch annotation.\");\n    } finally {\n      setIsLoading(false);\n      setProcessingProgress({\n        current: 0,\n        total: 0\n      });\n    }\n  };\n  const handleDownloadZip = async () => {\n    const successfulResults = annotatedResults.filter(result => result.success);\n    if (successfulResults.length === 0) {\n      alert(\"No successful annotations to download.\");\n      return;\n    }\n    try {\n      const response = await fetch(`/download-batch-zip/${batchId}`, {\n        method: 'POST'\n      });\n      if (response.ok) {\n        const blob = await response.blob();\n        const url = window.URL.createObjectURL(blob);\n        const a = document.createElement('a');\n        a.style.display = 'none';\n        a.href = url;\n        a.download = `annotated_${annotationType}_batch.zip`;\n        document.body.appendChild(a);\n        a.click();\n        window.URL.revokeObjectURL(url);\n        document.body.removeChild(a);\n      } else {\n        throw new Error('Failed to download zip file');\n      }\n    } catch (error) {\n      console.error('Error downloading zip:', error);\n      alert('Failed to download zip file. Please try again.');\n    }\n  };\n  const handleExportYoloDataset = async () => {\n    const groundingDinoResults = annotatedResults.filter(result => result.success && result.yolo_annotations);\n    if (groundingDinoResults.length === 0) {\n      alert(\"No GroundingDINO results to export.\");\n      return;\n    }\n    try {\n      const formData = new FormData();\n      formData.append('annotation_results', JSON.stringify(groundingDinoResults));\n      formData.append('dataset_name', `grounding_dino_${Date.now()}`);\n      const response = await fetch('/grounding-dino-export-yolo', {\n        method: 'POST',\n        body: formData\n      });\n      if (response.ok) {\n        const data = await response.json();\n        alert(`YOLO dataset exported successfully: ${data.dataset_name}`);\n      } else {\n        throw new Error('Failed to export dataset');\n      }\n    } catch (error) {\n      console.error('Error exporting dataset:', error);\n      alert('Failed to export YOLO dataset.');\n    }\n  };\n  const renderAnnotationTypeSelector = () => /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginBottom: '20px'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"\\uD83C\\uDFAF Annotation Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'grid',\n        gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))',\n        gap: '10px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #e2e8f0',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'detection' ? '#dbeafe' : 'white',\n          borderColor: annotationType === 'detection' ? '#3b82f6' : '#e2e8f0',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"detection\",\n          checked: annotationType === 'detection',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 320,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDCE6 OpenCV Detection\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 327,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 310,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #e2e8f0',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'segmentation' ? '#dbeafe' : 'white',\n          borderColor: annotationType === 'segmentation' ? '#3b82f6' : '#e2e8f0',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"segmentation\",\n          checked: annotationType === 'segmentation',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 340,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\u2702\\uFE0F OpenCV Segmentation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 330,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #e2e8f0',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'sam2-detection' ? '#dbeafe' : 'white',\n          borderColor: annotationType === 'sam2-detection' ? '#3b82f6' : '#e2e8f0',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"sam2-detection\",\n          checked: annotationType === 'sam2-detection',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 360,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83C\\uDFAF SAM2 Detection\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 367,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #e2e8f0',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'sam2-segmentation' ? '#dbeafe' : 'white',\n          borderColor: annotationType === 'sam2-segmentation' ? '#3b82f6' : '#e2e8f0',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"sam2-segmentation\",\n          checked: annotationType === 'sam2-segmentation',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 380,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDD2A SAM2 Segmentation\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 387,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 370,\n        columnNumber: 17\n      }, this), groundingDinoAvailable && /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #10b981',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'grounding-dino' ? '#d1fae5' : 'white',\n          borderColor: annotationType === 'grounding-dino' ? '#10b981' : '#10b981',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"grounding-dino\",\n          checked: annotationType === 'grounding-dino',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 401,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\u2728 GroundingDINO (AI-Powered)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 408,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 391,\n        columnNumber: 21\n      }, this), groundingDinoAvailable && /*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          padding: '10px',\n          border: '2px solid #7c3aed',\n          borderRadius: '8px',\n          backgroundColor: annotationType === 'guardrail' ? '#ede9fe' : 'white',\n          borderColor: annotationType === 'guardrail' ? '#7c3aed' : '#7c3aed',\n          cursor: 'pointer'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"radio\",\n          value: \"guardrail\",\n          checked: annotationType === 'guardrail',\n          onChange: e => setAnnotationType(e.target.value),\n          style: {\n            marginRight: '8px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 423,\n          columnNumber: 25\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"\\uD83D\\uDEE1\\uFE0F Guardrail (Anomaly + AI)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 430,\n          columnNumber: 25\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 13\n    }, this), !groundingDinoAvailable && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '10px',\n        padding: '10px',\n        backgroundColor: '#fef3c7',\n        border: '1px solid #f59e0b',\n        borderRadius: '4px',\n        fontSize: '14px'\n      },\n      children: \"\\u26A0\\uFE0F GroundingDINO not available. Please install dependencies to use AI-powered annotation.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 436,\n      columnNumber: 17\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 307,\n    columnNumber: 9\n  }, this);\n  const renderGroundingDinoOptions = () => {\n    if (annotationType !== 'grounding-dino') return null;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: '20px',\n        padding: '20px',\n        backgroundColor: '#f0fdf4',\n        border: '1px solid #10b981',\n        borderRadius: '8px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n        style: {\n          margin: '0 0 15px 0',\n          color: '#059669'\n        },\n        children: \"\\u2728 GroundingDINO Settings\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 461,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '15px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            display: 'block',\n            marginBottom: '5px',\n            fontWeight: 'bold'\n          },\n          children: \"Defect Prompts (comma-separated):\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 464,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: groundingDinoPrompts,\n          onChange: e => setGroundingDinoPrompts(e.target.value),\n          placeholder: \"e.g., scratch, dent, dirt, corrosion, crack\",\n          style: {\n            width: '100%',\n            padding: '8px',\n            border: '1px solid #d1d5db',\n            borderRadius: '4px',\n            fontSize: '14px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 467,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '12px',\n            color: '#6b7280',\n            marginTop: '5px'\n          },\n          children: \"Describe the defects you want to detect. Be specific (e.g., \\\"scratch on metal surface\\\").\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 463,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: '15px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          style: {\n            display: 'block',\n            marginBottom: '5px',\n            fontWeight: 'bold'\n          },\n          children: [\"Confidence Threshold: \", confidenceThreshold]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 486,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"range\",\n          min: \"0.1\",\n          max: \"0.9\",\n          step: \"0.1\",\n          value: confidenceThreshold,\n          onChange: e => setConfidenceThreshold(parseFloat(e.target.value)),\n          style: {\n            width: '200px'\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 489,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: '12px',\n            color: '#6b7280',\n            marginTop: '5px'\n          },\n          children: \"Lower values detect more objects but may include false positives.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 498,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 485,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 454,\n      columnNumber: 13\n    }, this);\n  };\n  const renderResults = () => {\n    if (annotatedResults.length === 0) return null;\n    const successfulResults = annotatedResults.filter(result => result.success);\n    const failedResults = annotatedResults.filter(result => !result.success);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '30px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"\\uD83D\\uDCCA Annotation Results\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 515,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: '10px'\n          },\n          children: [successfulResults.length > 0 && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleDownloadZip,\n            style: {\n              backgroundColor: '#059669',\n              color: 'white',\n              padding: '8px 16px',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer'\n            },\n            children: \"\\uD83D\\uDCE5 Download ZIP\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 518,\n            columnNumber: 29\n          }, this), annotationType === 'grounding-dino' && successfulResults.some(r => r.yolo_annotations) && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: handleExportYoloDataset,\n            style: {\n              backgroundColor: '#7c3aed',\n              color: 'white',\n              padding: '8px 16px',\n              border: 'none',\n              borderRadius: '4px',\n              cursor: 'pointer'\n            },\n            children: \"\\uD83D\\uDCE6 Export YOLO Dataset\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 533,\n            columnNumber: 29\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 516,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 514,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))',\n          gap: '20px',\n          marginBottom: '20px'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: '15px',\n            backgroundColor: '#dcfce7',\n            border: '1px solid #86efac',\n            borderRadius: '8px'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '18px',\n              fontWeight: 'bold',\n              color: '#059669'\n            },\n            children: [\"\\u2705 Successful: \", successfulResults.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 562,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: '15px',\n            backgroundColor: '#fee2e2',\n            border: '1px solid #fca5a5',\n            borderRadius: '8px'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: '18px',\n              fontWeight: 'bold',\n              color: '#dc2626'\n            },\n            children: [\"\\u274C Failed: \", failedResults.length]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 566,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 550,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))',\n          gap: '20px'\n        },\n        children: annotatedResults.map((result, index) => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            border: '1px solid #e2e8f0',\n            borderRadius: '8px',\n            padding: '15px',\n            backgroundColor: result.success ? '#f9fafb' : '#fef2f2'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n            style: {\n              margin: '0 0 10px 0'\n            },\n            children: result.originalName\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 586,\n            columnNumber: 29\n          }, this), result.success ? /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: result.annotatedUrl,\n              alt: `Annotated ${result.originalName}`,\n              style: {\n                width: '100%',\n                borderRadius: '4px',\n                marginBottom: '10px'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 590,\n              columnNumber: 37\n            }, this), result.detections && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: '14px',\n                color: '#6b7280'\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Detections:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 598,\n                columnNumber: 45\n              }, this), \" \", result.total_detections || result.detections.length, result.detections.map((detection, idx) => /*#__PURE__*/_jsxDEV(\"div\", {\n                style: {\n                  marginLeft: '10px',\n                  fontSize: '12px'\n                },\n                children: [\"\\u2022 \", detection.class, \": \", (detection.confidence * 100).toFixed(1), \"%\"]\n              }, idx, true, {\n                fileName: _jsxFileName,\n                lineNumber: 600,\n                columnNumber: 49\n              }, this))]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 597,\n              columnNumber: 41\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 589,\n            columnNumber: 33\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              color: '#dc2626'\n            },\n            children: [\"Error: \", result.error]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 608,\n            columnNumber: 33\n          }, this)]\n        }, index, true, {\n          fileName: _jsxFileName,\n          lineNumber: 580,\n          columnNumber: 25\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 578,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 513,\n      columnNumber: 13\n    }, this);\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '20px',\n      maxWidth: '1200px',\n      margin: '0 auto'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"\\uD83C\\uDFF7\\uFE0F Image Annotation\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 621,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: '20px'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        style: {\n          display: 'block',\n          marginBottom: '10px',\n          fontSize: '16px',\n          fontWeight: 'bold'\n        },\n        children: \"\\uD83D\\uDCC1 Select Images:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 624,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"file\",\n        multiple: true,\n        accept: \"image/*\",\n        onChange: handleFileChange,\n        style: {\n          padding: '10px',\n          border: '2px dashed #d1d5db',\n          borderRadius: '8px',\n          width: '100%',\n          cursor: 'pointer'\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 627,\n        columnNumber: 17\n      }, this), files.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: '10px',\n          fontSize: '14px',\n          color: '#059669'\n        },\n        children: [\"\\u2705 \", files.length, \" image(s) selected\"]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 641,\n        columnNumber: 21\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 623,\n      columnNumber: 13\n    }, this), renderAnnotationTypeSelector(), renderGroundingDinoOptions(), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: '30px'\n      },\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: handleAnnotate,\n        disabled: files.length === 0 || isLoading,\n        style: {\n          backgroundColor: files.length === 0 || isLoading ? '#9ca3af' : '#1e3a8a',\n          color: 'white',\n          padding: '12px 24px',\n          border: 'none',\n          borderRadius: '8px',\n          fontSize: '16px',\n          cursor: files.length === 0 || isLoading ? 'not-allowed' : 'pointer'\n        },\n        children: isLoading ? `🔄 Processing... (${processingProgress.current}/${processingProgress.total})` : '🚀 Start Annotation'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 651,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 650,\n      columnNumber: 13\n    }, this), renderResults()]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 620,\n    columnNumber: 9\n  }, this);\n}\nexport default Annotate;","map":{"version":3,"names":["React","useState","useEffect","jsxDEV","_jsxDEV","Annotate","files","setFiles","previews","setPreviews","annotatedResults","setAnnotatedResults","annotationType","setAnnotationType","isLoading","setIsLoading","processingProgress","setProcessingProgress","current","total","batchId","setBatchId","groundingDinoPrompts","setGroundingDinoPrompts","confidenceThreshold","setConfidenceThreshold","groundingDinoAvailable","setGroundingDinoAvailable","guardrailModelPath","setGuardrailModelPath","guardrailPrompts","setGuardrailPrompts","guardrailConfidenceThreshold","setGuardrailConfidenceThreshold","isTrainingAnomalyModel","setIsTrainingAnomalyModel","anomalyTrainingFiles","setAnomalyTrainingFiles","anomalyProjectName","setAnomalyProjectName","showAnomalyTraining","setShowAnomalyTraining","checkGroundingDinoStatus","response","fetch","data","json","available","error","console","handleFileChange","e","selectedFiles","Array","from","target","newPreviews","map","file","url","URL","createObjectURL","name","handleAnnotate","length","alert","newBatchId","Date","now","Math","random","toString","substr","handleGroundingDinoAnnotation","handleGuardrailAnnotation","handleTraditionalAnnotation","formData","FormData","forEach","append","method","body","ok","results","result","originalName","filename","success","status","annotatedUrl","image_base64","message","detections","total_detections","yolo_annotations","Error","i","push","annotated_image","btoa","String","fromCharCode","Uint8Array","endpointMap","endpoint","imageBlob","blob","handleDownloadZip","successfulResults","filter","window","a","document","createElement","style","display","href","download","appendChild","click","revokeObjectURL","removeChild","handleExportYoloDataset","groundingDinoResults","JSON","stringify","dataset_name","renderAnnotationTypeSelector","marginBottom","children","fileName","_jsxFileName","lineNumber","columnNumber","gridTemplateColumns","gap","alignItems","padding","border","borderRadius","backgroundColor","borderColor","cursor","type","value","checked","onChange","marginRight","marginTop","fontSize","renderGroundingDinoOptions","margin","color","fontWeight","placeholder","width","min","max","step","parseFloat","renderResults","failedResults","justifyContent","onClick","some","r","index","src","alt","detection","idx","marginLeft","class","confidence","toFixed","maxWidth","multiple","accept","disabled"],"sources":["/Users/truonghaidang/Desktop/open-trainer/frontend/src/components/Annotate.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\n\nfunction Annotate() {\n    const [files, setFiles] = useState([]);\n    const [previews, setPreviews] = useState([]);\n    const [annotatedResults, setAnnotatedResults] = useState([]);\n    const [annotationType, setAnnotationType] = useState('detection');\n    const [isLoading, setIsLoading] = useState(false);\n    const [processingProgress, setProcessingProgress] = useState({ current: 0, total: 0 });\n    const [batchId, setBatchId] = useState(null);\n    \n    // GroundingDINO specific state\n    const [groundingDinoPrompts, setGroundingDinoPrompts] = useState('scratch, dent, dirt');\n    const [confidenceThreshold, setConfidenceThreshold] = useState(0.3);\n    const [groundingDinoAvailable, setGroundingDinoAvailable] = useState(false);\n\n    // Guardrail (Anomaly Detection + Classification) specific state\n    const [guardrailModelPath, setGuardrailModelPath] = useState('');\n    const [guardrailPrompts, setGuardrailPrompts] = useState('scratch, dent, dirt');\n    const [guardrailConfidenceThreshold, setGuardrailConfidenceThreshold] = useState(0.3);\n    const [isTrainingAnomalyModel, setIsTrainingAnomalyModel] = useState(false);\n    const [anomalyTrainingFiles, setAnomalyTrainingFiles] = useState([]);\n    const [anomalyProjectName, setAnomalyProjectName] = useState('');\n    const [showAnomalyTraining, setShowAnomalyTraining] = useState(false);\n\n    // Check GroundingDINO availability on component mount\n    useEffect(() => {\n        checkGroundingDinoStatus();\n    }, []);\n\n    const checkGroundingDinoStatus = async () => {\n        try {\n            const response = await fetch('/grounding-dino-status');\n            const data = await response.json();\n            setGroundingDinoAvailable(data.available);\n        } catch (error) {\n            console.error('Error checking GroundingDINO status:', error);\n            setGroundingDinoAvailable(false);\n        }\n    };\n\n    const handleFileChange = (e) => {\n        const selectedFiles = Array.from(e.target.files);\n        setFiles(selectedFiles);\n        \n        // Create previews for all selected files\n        const newPreviews = selectedFiles.map(file => ({\n            file,\n            url: URL.createObjectURL(file),\n            name: file.name\n        }));\n        setPreviews(newPreviews);\n        setAnnotatedResults([]); // Reset results when new files are selected\n    };\n\n    const handleAnnotate = async () => {\n        if (files.length === 0) {\n            alert(\"Please select at least one file first.\");\n            return;\n        }\n\n        setIsLoading(true);\n        setProcessingProgress({ current: 0, total: files.length });\n        setAnnotatedResults([]);\n\n        // Generate unique batch ID\n        const newBatchId = `batch_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n        setBatchId(newBatchId);\n\n        if (annotationType === 'grounding-dino') {\n            await handleGroundingDinoAnnotation(newBatchId);\n        } else if (annotationType === 'guardrail') {\n            await handleGuardrailAnnotation(newBatchId);\n        } else {\n            await handleTraditionalAnnotation(newBatchId);\n        }\n    };\n\n    const handleGroundingDinoAnnotation = async (newBatchId) => {\n        try {\n            const formData = new FormData();\n            files.forEach(file => formData.append('files', file));\n            formData.append('prompts', groundingDinoPrompts);\n            formData.append('confidence_threshold', confidenceThreshold);\n\n            const response = await fetch('/grounding-dino-batch', {\n                method: 'POST',\n                body: formData\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                \n                const results = data.results.map(result => ({\n                    originalName: result.filename,\n                    success: result.status === 'success',\n                    annotatedUrl: result.status === 'success' ? `data:image/jpeg;base64,${result.image_base64}` : null,\n                    error: result.status !== 'success' ? result.message : null,\n                    detections: result.detections || [],\n                    total_detections: result.total_detections || 0,\n                    yolo_annotations: result.yolo_annotations\n                }));\n\n                setAnnotatedResults(results);\n            } else {\n                throw new Error('GroundingDINO batch annotation failed');\n            }\n        } catch (error) {\n            console.error('GroundingDINO annotation error:', error);\n            alert('GroundingDINO annotation failed. Please try again.');\n        } finally {\n            setIsLoading(false);\n            setProcessingProgress({ current: 0, total: 0 });\n        }\n    };\n\n    const handleGuardrailAnnotation = async (newBatchId) => {\n        if (!guardrailModelPath) {\n            alert(\"Please provide the path to your trained anomaly model.\");\n            setIsLoading(false);\n            return;\n        }\n\n        const results = [];\n\n        try {\n            for (let i = 0; i < files.length; i++) {\n                const file = files[i];\n                setProcessingProgress({ current: i + 1, total: files.length });\n\n                const formData = new FormData();\n                formData.append(\"file\", file);\n                formData.append(\"model_path\", guardrailModelPath);\n                formData.append(\"prompts\", guardrailPrompts);\n                formData.append(\"confidence_threshold\", guardrailConfidenceThreshold);\n\n                try {\n                    const response = await fetch('/annotate-with-guardrail', {\n                        method: 'POST',\n                        body: formData\n                    });\n\n                    if (response.ok) {\n                        const data = await response.json();\n                        results.push({\n                            originalName: file.name,\n                            success: data.status === 'success',\n                            annotatedUrl: data.status === 'success' && data.annotated_image ? \n                                `data:image/jpeg;base64,${btoa(String.fromCharCode(...new Uint8Array(data.annotated_image)))}` : null,\n                            error: data.status !== 'success' ? data.message : null,\n                            detections: data.detections || [],\n                            total_detections: data.detections ? data.detections.length : 0\n                        });\n                    } else {\n                        results.push({\n                            originalName: file.name,\n                            success: false,\n                            error: \"Guardrail annotation failed\"\n                        });\n                    }\n                } catch (error) {\n                    console.error(`Error processing ${file.name}:`, error);\n                    results.push({\n                        originalName: file.name,\n                        success: false,\n                        error: \"Processing error\"\n                    });\n                }\n            }\n\n            setAnnotatedResults(results);\n        } catch (error) {\n            console.error('Guardrail annotation error:', error);\n            alert('Guardrail annotation failed. Please try again.');\n        } finally {\n            setIsLoading(false);\n            setProcessingProgress({ current: 0, total: 0 });\n        }\n    };\n\n    const handleTraditionalAnnotation = async (newBatchId) => {\n        const endpointMap = {\n            'detection': '/pre-annotate-detect',\n            'segmentation': '/pre-annotate-segment',\n            'sam2-detection': '/pre-annotate-sam2-detect',\n            'sam2-segmentation': '/pre-annotate-sam2-segment'\n        };\n        const endpoint = endpointMap[annotationType] || '/pre-annotate-detect';\n\n        const results = [];\n\n        try {\n            for (let i = 0; i < files.length; i++) {\n                const file = files[i];\n                setProcessingProgress({ current: i + 1, total: files.length });\n\n                const formData = new FormData();\n                formData.append(\"file\", file);\n                formData.append(\"batch_id\", newBatchId); // Add batch ID for caching\n\n                try {\n                    const response = await fetch(endpoint, {\n                        method: \"POST\",\n                        body: formData,\n                    });\n\n                    if (response.ok) {\n                        const imageBlob = await response.blob();\n                        results.push({\n                            originalName: file.name,\n                            annotatedUrl: URL.createObjectURL(imageBlob),\n                            success: true\n                        });\n                    } else {\n                        results.push({\n                            originalName: file.name,\n                            success: false,\n                            error: `${annotationType} annotation failed`\n                        });\n                    }\n                } catch (error) {\n                    console.error(`Error processing ${file.name}:`, error);\n                    results.push({\n                        originalName: file.name,\n                        success: false,\n                        error: \"Processing error\"\n                    });\n                }\n            }\n\n            setAnnotatedResults(results);\n        } catch (error) {\n            console.error(\"Error during batch annotation:\", error);\n            alert(\"An error occurred during batch annotation.\");\n        } finally {\n            setIsLoading(false);\n            setProcessingProgress({ current: 0, total: 0 });\n        }\n    };\n\n    const handleDownloadZip = async () => {\n        const successfulResults = annotatedResults.filter(result => result.success);\n        \n        if (successfulResults.length === 0) {\n            alert(\"No successful annotations to download.\");\n            return;\n        }\n\n        try {\n            const response = await fetch(`/download-batch-zip/${batchId}`, {\n                method: 'POST',\n            });\n\n            if (response.ok) {\n                const blob = await response.blob();\n                const url = window.URL.createObjectURL(blob);\n                const a = document.createElement('a');\n                a.style.display = 'none';\n                a.href = url;\n                a.download = `annotated_${annotationType}_batch.zip`;\n                document.body.appendChild(a);\n                a.click();\n                window.URL.revokeObjectURL(url);\n                document.body.removeChild(a);\n            } else {\n                throw new Error('Failed to download zip file');\n            }\n        } catch (error) {\n            console.error('Error downloading zip:', error);\n            alert('Failed to download zip file. Please try again.');\n        }\n    };\n\n    const handleExportYoloDataset = async () => {\n        const groundingDinoResults = annotatedResults.filter(result => \n            result.success && result.yolo_annotations\n        );\n\n        if (groundingDinoResults.length === 0) {\n            alert(\"No GroundingDINO results to export.\");\n            return;\n        }\n\n        try {\n            const formData = new FormData();\n            formData.append('annotation_results', JSON.stringify(groundingDinoResults));\n            formData.append('dataset_name', `grounding_dino_${Date.now()}`);\n\n            const response = await fetch('/grounding-dino-export-yolo', {\n                method: 'POST',\n                body: formData\n            });\n\n            if (response.ok) {\n                const data = await response.json();\n                alert(`YOLO dataset exported successfully: ${data.dataset_name}`);\n            } else {\n                throw new Error('Failed to export dataset');\n            }\n        } catch (error) {\n            console.error('Error exporting dataset:', error);\n            alert('Failed to export YOLO dataset.');\n        }\n    };\n\n    const renderAnnotationTypeSelector = () => (\n        <div style={{ marginBottom: '20px' }}>\n            <h3>🎯 Annotation Method</h3>\n            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(200px, 1fr))', gap: '10px' }}>\n                <label style={{ \n                    display: 'flex', \n                    alignItems: 'center',\n                    padding: '10px',\n                    border: '2px solid #e2e8f0',\n                    borderRadius: '8px',\n                    backgroundColor: annotationType === 'detection' ? '#dbeafe' : 'white',\n                    borderColor: annotationType === 'detection' ? '#3b82f6' : '#e2e8f0',\n                    cursor: 'pointer'\n                }}>\n                    <input\n                        type=\"radio\"\n                        value=\"detection\"\n                        checked={annotationType === 'detection'}\n                        onChange={(e) => setAnnotationType(e.target.value)}\n                        style={{ marginRight: '8px' }}\n                    />\n                    <span>📦 OpenCV Detection</span>\n                </label>\n\n                <label style={{\n                    display: 'flex', \n                    alignItems: 'center',\n                    padding: '10px',\n                    border: '2px solid #e2e8f0',\n                    borderRadius: '8px',\n                    backgroundColor: annotationType === 'segmentation' ? '#dbeafe' : 'white',\n                    borderColor: annotationType === 'segmentation' ? '#3b82f6' : '#e2e8f0',\n                    cursor: 'pointer'\n                }}>\n                    <input\n                        type=\"radio\"\n                        value=\"segmentation\"\n                        checked={annotationType === 'segmentation'}\n                        onChange={(e) => setAnnotationType(e.target.value)}\n                        style={{ marginRight: '8px' }}\n                    />\n                    <span>✂️ OpenCV Segmentation</span>\n                </label>\n\n                <label style={{\n                    display: 'flex', \n                    alignItems: 'center',\n                    padding: '10px',\n                    border: '2px solid #e2e8f0',\n                    borderRadius: '8px',\n                    backgroundColor: annotationType === 'sam2-detection' ? '#dbeafe' : 'white',\n                    borderColor: annotationType === 'sam2-detection' ? '#3b82f6' : '#e2e8f0',\n                    cursor: 'pointer'\n                }}>\n                    <input\n                        type=\"radio\"\n                        value=\"sam2-detection\"\n                        checked={annotationType === 'sam2-detection'}\n                        onChange={(e) => setAnnotationType(e.target.value)}\n                        style={{ marginRight: '8px' }}\n                    />\n                    <span>🎯 SAM2 Detection</span>\n                </label>\n\n                <label style={{\n                    display: 'flex', \n                    alignItems: 'center',\n                    padding: '10px',\n                    border: '2px solid #e2e8f0',\n                    borderRadius: '8px',\n                    backgroundColor: annotationType === 'sam2-segmentation' ? '#dbeafe' : 'white',\n                    borderColor: annotationType === 'sam2-segmentation' ? '#3b82f6' : '#e2e8f0',\n                    cursor: 'pointer'\n                }}>\n                    <input\n                        type=\"radio\"\n                        value=\"sam2-segmentation\"\n                        checked={annotationType === 'sam2-segmentation'}\n                        onChange={(e) => setAnnotationType(e.target.value)}\n                        style={{ marginRight: '8px' }}\n                    />\n                    <span>🔪 SAM2 Segmentation</span>\n                </label>\n\n                {groundingDinoAvailable && (\n                    <label style={{\n                        display: 'flex', \n                        alignItems: 'center',\n                        padding: '10px',\n                        border: '2px solid #10b981',\n                        borderRadius: '8px',\n                        backgroundColor: annotationType === 'grounding-dino' ? '#d1fae5' : 'white',\n                        borderColor: annotationType === 'grounding-dino' ? '#10b981' : '#10b981',\n                        cursor: 'pointer'\n                    }}>\n                        <input\n                            type=\"radio\"\n                            value=\"grounding-dino\"\n                            checked={annotationType === 'grounding-dino'}\n                            onChange={(e) => setAnnotationType(e.target.value)}\n                            style={{ marginRight: '8px' }}\n                        />\n                        <span>✨ GroundingDINO (AI-Powered)</span>\n                    </label>\n                )}\n\n                {groundingDinoAvailable && (\n                    <label style={{\n                        display: 'flex', \n                        alignItems: 'center',\n                        padding: '10px',\n                        border: '2px solid #7c3aed',\n                        borderRadius: '8px',\n                        backgroundColor: annotationType === 'guardrail' ? '#ede9fe' : 'white',\n                        borderColor: annotationType === 'guardrail' ? '#7c3aed' : '#7c3aed',\n                        cursor: 'pointer'\n                    }}>\n                        <input\n                            type=\"radio\"\n                            value=\"guardrail\"\n                            checked={annotationType === 'guardrail'}\n                            onChange={(e) => setAnnotationType(e.target.value)}\n                            style={{ marginRight: '8px' }}\n                        />\n                        <span>🛡️ Guardrail (Anomaly + AI)</span>\n                    </label>\n                )}\n            </div>\n\n            {!groundingDinoAvailable && (\n                <div style={{ \n                    marginTop: '10px', \n                    padding: '10px', \n                    backgroundColor: '#fef3c7', \n                    border: '1px solid #f59e0b',\n                    borderRadius: '4px',\n                    fontSize: '14px'\n                }}>\n                    ⚠️ GroundingDINO not available. Please install dependencies to use AI-powered annotation.\n                </div>\n            )}\n        </div>\n    );\n\n    const renderGroundingDinoOptions = () => {\n        if (annotationType !== 'grounding-dino') return null;\n\n        return (\n            <div style={{\n                marginBottom: '20px',\n                padding: '20px',\n                backgroundColor: '#f0fdf4',\n                border: '1px solid #10b981',\n                borderRadius: '8px'\n            }}>\n                <h4 style={{ margin: '0 0 15px 0', color: '#059669' }}>✨ GroundingDINO Settings</h4>\n                \n                <div style={{ marginBottom: '15px' }}>\n                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>\n                        Defect Prompts (comma-separated):\n                    </label>\n                    <input\n                        type=\"text\"\n                        value={groundingDinoPrompts}\n                        onChange={(e) => setGroundingDinoPrompts(e.target.value)}\n                        placeholder=\"e.g., scratch, dent, dirt, corrosion, crack\"\n                        style={{ \n                            width: '100%', \n                            padding: '8px', \n                            border: '1px solid #d1d5db',\n                            borderRadius: '4px',\n                            fontSize: '14px'\n                        }}\n                    />\n                    <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '5px' }}>\n                        Describe the defects you want to detect. Be specific (e.g., \"scratch on metal surface\").\n                    </div>\n                </div>\n\n                <div style={{ marginBottom: '15px' }}>\n                    <label style={{ display: 'block', marginBottom: '5px', fontWeight: 'bold' }}>\n                        Confidence Threshold: {confidenceThreshold}\n                    </label>\n                    <input\n                        type=\"range\"\n                        min=\"0.1\"\n                        max=\"0.9\"\n                        step=\"0.1\"\n                        value={confidenceThreshold}\n                        onChange={(e) => setConfidenceThreshold(parseFloat(e.target.value))}\n                        style={{ width: '200px' }}\n                    />\n                    <div style={{ fontSize: '12px', color: '#6b7280', marginTop: '5px' }}>\n                        Lower values detect more objects but may include false positives.\n                    </div>\n                </div>\n            </div>\n        );\n    };\n\n    const renderResults = () => {\n        if (annotatedResults.length === 0) return null;\n\n        const successfulResults = annotatedResults.filter(result => result.success);\n        const failedResults = annotatedResults.filter(result => !result.success);\n\n        return (\n            <div style={{ marginTop: '30px' }}>\n                <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }}>\n                    <h3>📊 Annotation Results</h3>\n                    <div style={{ display: 'flex', gap: '10px' }}>\n                        {successfulResults.length > 0 && (\n                            <button \n                                onClick={handleDownloadZip}\n                                style={{\n                                    backgroundColor: '#059669',\n                                    color: 'white',\n                                    padding: '8px 16px',\n                                    border: 'none',\n                                    borderRadius: '4px',\n                                    cursor: 'pointer'\n                                }}\n                            >\n                                📥 Download ZIP\n                            </button>\n                        )}\n                        {annotationType === 'grounding-dino' && successfulResults.some(r => r.yolo_annotations) && (\n                            <button \n                                onClick={handleExportYoloDataset}\n                                style={{\n                                    backgroundColor: '#7c3aed',\n                                    color: 'white',\n                                    padding: '8px 16px',\n                                    border: 'none',\n                                    borderRadius: '4px',\n                                    cursor: 'pointer'\n                                }}\n                            >\n                                📦 Export YOLO Dataset\n                            </button>\n                        )}\n                    </div>\n                </div>\n\n                <div style={{ \n                    display: 'grid', \n                    gridTemplateColumns: 'repeat(auto-fit, minmax(300px, 1fr))', \n                    gap: '20px',\n                    marginBottom: '20px'\n                }}>\n                    <div style={{\n                        padding: '15px',\n                        backgroundColor: '#dcfce7',\n                        border: '1px solid #86efac',\n                        borderRadius: '8px'\n                    }}>\n                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#059669' }}>\n                            ✅ Successful: {successfulResults.length}\n                        </div>\n                    </div>\n                    <div style={{\n                        padding: '15px',\n                        backgroundColor: '#fee2e2',\n                        border: '1px solid #fca5a5',\n                        borderRadius: '8px'\n                    }}>\n                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#dc2626' }}>\n                            ❌ Failed: {failedResults.length}\n                        </div>\n                    </div>\n                </div>\n\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '20px' }}>\n                    {annotatedResults.map((result, index) => (\n                        <div key={index} style={{ \n                            border: '1px solid #e2e8f0', \n                            borderRadius: '8px', \n                            padding: '15px',\n                            backgroundColor: result.success ? '#f9fafb' : '#fef2f2'\n                        }}>\n                            <h4 style={{ margin: '0 0 10px 0' }}>{result.originalName}</h4>\n                            \n                            {result.success ? (\n                                <div>\n                                    <img \n                                        src={result.annotatedUrl} \n                                        alt={`Annotated ${result.originalName}`} \n                                        style={{ width: '100%', borderRadius: '4px', marginBottom: '10px' }}\n                                    />\n                                    \n                                    {result.detections && (\n                                        <div style={{ fontSize: '14px', color: '#6b7280' }}>\n                                            <strong>Detections:</strong> {result.total_detections || result.detections.length}\n                                            {result.detections.map((detection, idx) => (\n                                                <div key={idx} style={{ marginLeft: '10px', fontSize: '12px' }}>\n                                                    • {detection.class}: {(detection.confidence * 100).toFixed(1)}%\n                                                </div>\n                                            ))}\n                                        </div>\n                                    )}\n                                </div>\n                            ) : (\n                                <div style={{ color: '#dc2626' }}>\n                                    Error: {result.error}\n                                </div>\n                            )}\n                        </div>\n                    ))}\n                </div>\n            </div>\n        );\n    };\n\n    return (\n        <div style={{ padding: '20px', maxWidth: '1200px', margin: '0 auto' }}>\n            <h2>🏷️ Image Annotation</h2>\n            \n            <div style={{ marginBottom: '20px' }}>\n                <label style={{ display: 'block', marginBottom: '10px', fontSize: '16px', fontWeight: 'bold' }}>\n                    📁 Select Images:\n                </label>\n                <input \n                    type=\"file\" \n                    multiple \n                    accept=\"image/*\"\n                    onChange={handleFileChange}\n                    style={{ \n                        padding: '10px',\n                        border: '2px dashed #d1d5db',\n                        borderRadius: '8px',\n                        width: '100%',\n                        cursor: 'pointer'\n                    }}\n                />\n                {files.length > 0 && (\n                    <div style={{ marginTop: '10px', fontSize: '14px', color: '#059669' }}>\n                        ✅ {files.length} image(s) selected\n                    </div>\n                )}\n            </div>\n\n            {renderAnnotationTypeSelector()}\n            {renderGroundingDinoOptions()}\n\n            <div style={{ marginBottom: '30px' }}>\n                <button \n                    onClick={handleAnnotate}\n                    disabled={files.length === 0 || isLoading}\n                    style={{\n                        backgroundColor: files.length === 0 || isLoading ? '#9ca3af' : '#1e3a8a',\n                        color: 'white',\n                        padding: '12px 24px',\n                        border: 'none',\n                        borderRadius: '8px',\n                        fontSize: '16px',\n                        cursor: files.length === 0 || isLoading ? 'not-allowed' : 'pointer'\n                    }}\n                >\n                    {isLoading ? `🔄 Processing... (${processingProgress.current}/${processingProgress.total})` : '🚀 Start Annotation'}\n                </button>\n            </div>\n\n            {renderResults()}\n        </div>\n    );\n}\n\nexport default Annotate;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}