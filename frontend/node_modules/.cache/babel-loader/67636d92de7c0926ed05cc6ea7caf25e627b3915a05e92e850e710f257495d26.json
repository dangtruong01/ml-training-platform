{"ast":null,"code":"import React,{useState,useEffect}from'react';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";function Annotate(){const[files,setFiles]=useState([]);// const [previews, setPreviews] = useState([]);\nconst[annotatedResults,setAnnotatedResults]=useState([]);const[annotationType,setAnnotationType]=useState('detection');const[isLoading,setIsLoading]=useState(false);const[processingProgress,setProcessingProgress]=useState({current:0,total:0});const[batchId,setBatchId]=useState(null);// GroundingDINO specific state\nconst[groundingDinoPrompts,setGroundingDinoPrompts]=useState('scratch, dent, dirt');const[confidenceThreshold,setConfidenceThreshold]=useState(0.3);const[groundingDinoAvailable,setGroundingDinoAvailable]=useState(false);// Guardrail (Anomaly Detection + Classification) specific state\nconst[guardrailModelFile,setGuardrailModelFile]=useState(null);const[guardrailPrompts,setGuardrailPrompts]=useState('scratch, dent, dirt');const[guardrailConfidenceThreshold,setGuardrailConfidenceThreshold]=useState(0.3);// LLM+CLIP Anomaly Detection specific state\nconst[llmClipAvailable,setLlmClipAvailable]=useState(false);const[componentType,setComponentType]=useState('metal plate');const[componentContext,setComponentContext]=useState('automotive');const[useLLM,setUseLLM]=useState(true);const[similarityThreshold,setSimilarityThreshold]=useState(0.7);// Check GroundingDINO and LLM+CLIP availability on component mount\nuseEffect(()=>{checkGroundingDinoStatus();checkLlmClipStatus();},[]);const checkGroundingDinoStatus=async()=>{try{console.log('🔍 Checking GroundingDINO status...');const response=await fetch('/grounding-dino-status');console.log('📡 Response status:',response.status);const data=await response.json();console.log('📊 Response data:',data);setGroundingDinoAvailable(data.available);console.log('✅ GroundingDINO available set to:',data.available);}catch(error){console.error('❌ Error checking GroundingDINO status:',error);setGroundingDinoAvailable(false);}};const checkLlmClipStatus=async()=>{try{console.log('🧠 Checking LLM+CLIP status...');const response=await fetch('/llm-clip-status');const data=await response.json();console.log('📊 LLM+CLIP status:',data);setLlmClipAvailable(data.service_available);console.log('✅ LLM+CLIP available set to:',data.service_available);}catch(error){console.error('❌ Error checking LLM+CLIP status:',error);setLlmClipAvailable(false);}};const handleFileChange=e=>{const selectedFiles=Array.from(e.target.files);setFiles(selectedFiles);// Create previews for all selected files\nconst newPreviews=selectedFiles.map(file=>({file,url:URL.createObjectURL(file),name:file.name}));// setPreviews(newPreviews);\nsetAnnotatedResults([]);// Reset results when new files are selected\n};const handleAnnotate=async()=>{if(files.length===0){alert(\"Please select at least one file first.\");return;}setIsLoading(true);setProcessingProgress({current:0,total:files.length});setAnnotatedResults([]);// Generate unique batch ID\nconst newBatchId=\"batch_\".concat(Date.now(),\"_\").concat(Math.random().toString(36).substr(2,9));setBatchId(newBatchId);if(annotationType==='grounding-dino-only'){await handleGroundingDinoOnlyAnnotation(newBatchId);}else if(annotationType==='grounding-dino-sam2'){await handleGroundingDinoSAM2Annotation(newBatchId);}else if(annotationType==='guardrail'){await handleGuardrailAnnotation(newBatchId);}else if(annotationType==='llm-clip-anomaly'){await handleLlmClipAnomalyAnnotation(newBatchId);}else{await handleTraditionalAnnotation(newBatchId);}};const handleGroundingDinoSAM2Annotation=async newBatchId=>{const results=[];try{for(let i=0;i<files.length;i++){const file=files[i];setProcessingProgress({current:i+1,total:files.length});const formData=new FormData();formData.append('file',file);formData.append('prompts',groundingDinoPrompts);formData.append('confidence_threshold',confidenceThreshold);formData.append('batch_id',newBatchId);try{const response=await fetch('/grounding-dino-annotate',{method:'POST',body:formData});if(response.ok){const result=await response.json();results.push({originalName:file.name,success:result.status==='success',annotatedUrl:result.status==='success'?\"data:image/jpeg;base64,\".concat(result.image_base64):null,error:result.status!=='success'?result.message:null,detections:result.detections||[],total_detections:result.total_detections||0,yolo_annotations:result.yolo_annotations});}else{results.push({originalName:file.name,success:false,error:\"GroundingDINO annotation failed\"});}}catch(error){console.error(\"Error processing \".concat(file.name,\":\"),error);results.push({originalName:file.name,success:false,error:\"Processing error\"});}}setAnnotatedResults(results);}catch(error){console.error('GroundingDINO annotation error:',error);alert('GroundingDINO annotation failed. Please try again.');}finally{setIsLoading(false);setProcessingProgress({current:0,total:0});}};const handleGroundingDinoOnlyAnnotation=async newBatchId=>{const results=[];try{for(let i=0;i<files.length;i++){const file=files[i];setProcessingProgress({current:i+1,total:files.length});const formData=new FormData();formData.append('file',file);formData.append('prompts',groundingDinoPrompts);formData.append('confidence_threshold',confidenceThreshold);formData.append('batch_id',newBatchId);try{const response=await fetch('/grounding-dino-only-annotate',{method:'POST',body:formData});if(response.ok){const result=await response.json();results.push({originalName:file.name,success:result.status==='success',annotatedUrl:result.status==='success'?\"data:image/jpeg;base64,\".concat(result.image_base64):null,error:result.status!=='success'?result.message:null,detections:result.detections||[],total_detections:result.total_detections||0,yolo_annotations:result.yolo_annotations});}else{results.push({originalName:file.name,success:false,error:\"GroundingDINO annotation failed\"});}}catch(error){console.error(\"Error processing \".concat(file.name,\":\"),error);results.push({originalName:file.name,success:false,error:\"Processing error\"});}}setAnnotatedResults(results);}catch(error){console.error('GroundingDINO annotation error:',error);alert('GroundingDINO annotation failed. Please try again.');}finally{setIsLoading(false);setProcessingProgress({current:0,total:0});}};const handleGuardrailAnnotation=async newBatchId=>{if(!guardrailModelFile){alert(\"Please upload your trained anomaly model file (.ckpt).\");setIsLoading(false);return;}const results=[];try{for(let i=0;i<files.length;i++){const file=files[i];setProcessingProgress({current:i+1,total:files.length});const formData=new FormData();formData.append(\"file\",file);formData.append(\"model_file\",guardrailModelFile);formData.append(\"prompts\",guardrailPrompts);formData.append(\"confidence_threshold\",guardrailConfidenceThreshold);try{const response=await fetch('/annotate-with-guardrail',{method:'POST',body:formData});if(response.ok){const data=await response.json();results.push({originalName:file.name,success:data.status==='success',annotatedUrl:data.status==='success'&&data.annotated_image?\"data:image/jpeg;base64,\".concat(btoa(String.fromCharCode(...new Uint8Array(data.annotated_image)))):null,error:data.status!=='success'?data.message:null,detections:data.detections||[],total_detections:data.detections?data.detections.length:0});}else{results.push({originalName:file.name,success:false,error:\"Guardrail annotation failed\"});}}catch(error){console.error(\"Error processing \".concat(file.name,\":\"),error);results.push({originalName:file.name,success:false,error:\"Processing error\"});}}setAnnotatedResults(results);}catch(error){console.error('Guardrail annotation error:',error);alert('Guardrail annotation failed. Please try again.');}finally{setIsLoading(false);setProcessingProgress({current:0,total:0});}};const handleLlmClipAnomalyAnnotation=async newBatchId=>{const results=[];try{for(let i=0;i<files.length;i++){const file=files[i];setProcessingProgress({current:i+1,total:files.length});const formData=new FormData();formData.append('file',file);formData.append('component_type',componentType);formData.append('context',componentContext);formData.append('confidence_threshold',confidenceThreshold);formData.append('similarity_threshold',similarityThreshold);formData.append('use_llm',useLLM);formData.append('batch_id',newBatchId);try{const response=await fetch('/llm-clip-anomaly-detect',{method:'POST',body:formData});if(response.ok){const result=await response.json();results.push({originalName:file.name,success:result.status==='success',annotatedUrl:result.status==='success'?\"data:image/jpeg;base64,\".concat(result.image_base64):null,error:result.status!=='success'?result.message:null,anomaly_regions:result.anomaly_regions_detected||0,total_regions:result.total_regions_detected||0,anomaly_rate:result.anomaly_rate||0,detections:result.detections||[],component_type:result.component_type,descriptions_used:result.descriptions_used});}else{results.push({originalName:file.name,success:false,error:\"LLM+CLIP anomaly detection failed\"});}}catch(error){console.error(\"Error processing \".concat(file.name,\":\"),error);results.push({originalName:file.name,success:false,error:\"Processing error\"});}}setAnnotatedResults(results);}catch(error){console.error('LLM+CLIP annotation error:',error);alert('LLM+CLIP annotation failed. Please try again.');}finally{setIsLoading(false);setProcessingProgress({current:0,total:0});}};const handleTraditionalAnnotation=async newBatchId=>{const endpointMap={'detection':'/pre-annotate-detect','segmentation':'/pre-annotate-segment','sam2-detection':'/pre-annotate-sam2-detect','sam2-segmentation':'/pre-annotate-sam2-segment'};const endpoint=endpointMap[annotationType]||'/pre-annotate-detect';const results=[];try{for(let i=0;i<files.length;i++){const file=files[i];setProcessingProgress({current:i+1,total:files.length});const formData=new FormData();formData.append(\"file\",file);formData.append(\"batch_id\",newBatchId);// Add batch ID for caching\ntry{const response=await fetch(endpoint,{method:\"POST\",body:formData});if(response.ok){const imageBlob=await response.blob();results.push({originalName:file.name,annotatedUrl:URL.createObjectURL(imageBlob),success:true});}else{results.push({originalName:file.name,success:false,error:\"\".concat(annotationType,\" annotation failed\")});}}catch(error){console.error(\"Error processing \".concat(file.name,\":\"),error);results.push({originalName:file.name,success:false,error:\"Processing error\"});}}setAnnotatedResults(results);}catch(error){console.error(\"Error during batch annotation:\",error);alert(\"An error occurred during batch annotation.\");}finally{setIsLoading(false);setProcessingProgress({current:0,total:0});}};const handleDownloadZip=async()=>{const successfulResults=annotatedResults.filter(result=>result.success);if(successfulResults.length===0){alert(\"No successful annotations to download.\");return;}try{const response=await fetch(\"/download-batch-zip/\".concat(batchId),{method:'POST'});if(response.ok){const blob=await response.blob();const url=window.URL.createObjectURL(blob);const a=document.createElement('a');a.style.display='none';a.href=url;a.download=\"annotated_\".concat(annotationType,\"_batch.zip\");document.body.appendChild(a);a.click();window.URL.revokeObjectURL(url);document.body.removeChild(a);}else{throw new Error('Failed to download zip file');}}catch(error){console.error('Error downloading zip:',error);alert('Failed to download zip file. Please try again.');}};const handleExportYoloDataset=async()=>{const groundingDinoResults=annotatedResults.filter(result=>result.success&&result.yolo_annotations);if(groundingDinoResults.length===0){alert(\"No GroundingDINO results to export.\");return;}try{const formData=new FormData();formData.append('annotation_results',JSON.stringify(groundingDinoResults));formData.append('dataset_name',\"grounding_dino_\".concat(Date.now()));const response=await fetch('/grounding-dino-export-yolo',{method:'POST',body:formData});if(response.ok){const data=await response.json();alert(\"YOLO dataset exported successfully: \".concat(data.dataset_name));}else{throw new Error('Failed to export dataset');}}catch(error){console.error('Error exporting dataset:',error);alert('Failed to export YOLO dataset.');}};const renderAnnotationTypeSelector=()=>/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83C\\uDFAF Annotation Method\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(200px, 1fr))',gap:'10px'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #e2e8f0',borderRadius:'8px',backgroundColor:annotationType==='detection'?'#dbeafe':'white',borderColor:annotationType==='detection'?'#3b82f6':'#e2e8f0',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"detection\",checked:annotationType==='detection',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDCE6 OpenCV Detection\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #e2e8f0',borderRadius:'8px',backgroundColor:annotationType==='segmentation'?'#dbeafe':'white',borderColor:annotationType==='segmentation'?'#3b82f6':'#e2e8f0',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"segmentation\",checked:annotationType==='segmentation',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2702\\uFE0F OpenCV Segmentation\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #e2e8f0',borderRadius:'8px',backgroundColor:annotationType==='sam2-detection'?'#dbeafe':'white',borderColor:annotationType==='sam2-detection'?'#3b82f6':'#e2e8f0',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"sam2-detection\",checked:annotationType==='sam2-detection',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAF SAM2 Detection\"})]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #e2e8f0',borderRadius:'8px',backgroundColor:annotationType==='sam2-segmentation'?'#dbeafe':'white',borderColor:annotationType==='sam2-segmentation'?'#3b82f6':'#e2e8f0',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"sam2-segmentation\",checked:annotationType==='sam2-segmentation',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDD2A SAM2 Segmentation\"})]}),groundingDinoAvailable&&/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #10b981',borderRadius:'8px',backgroundColor:annotationType==='grounding-dino-only'?'#d1fae5':'white',borderColor:annotationType==='grounding-dino-only'?'#10b981':'#10b981',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"grounding-dino-only\",checked:annotationType==='grounding-dino-only',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\u2728 GroundingDINO Only (Detection)\"})]}),groundingDinoAvailable&&/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #7c2d12',borderRadius:'8px',backgroundColor:annotationType==='grounding-dino-sam2'?'#fed7aa':'white',borderColor:annotationType==='grounding-dino-sam2'?'#7c2d12':'#7c2d12',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"grounding-dino-sam2\",checked:annotationType==='grounding-dino-sam2',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83C\\uDFAD GroundingDINO + SAM2 (Detection + Segmentation)\"})]}),groundingDinoAvailable&&/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #7c3aed',borderRadius:'8px',backgroundColor:annotationType==='guardrail'?'#ede9fe':'white',borderColor:annotationType==='guardrail'?'#7c3aed':'#7c3aed',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"guardrail\",checked:annotationType==='guardrail',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83D\\uDEE1\\uFE0F Guardrail (Anomaly + AI)\"})]}),llmClipAvailable&&/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center',padding:'10px',border:'2px solid #8b5cf6',borderRadius:'8px',backgroundColor:annotationType==='llm-clip-anomaly'?'#f3e8ff':'white',borderColor:annotationType==='llm-clip-anomaly'?'#8b5cf6':'#8b5cf6',cursor:'pointer'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",value:\"llm-clip-anomaly\",checked:annotationType==='llm-clip-anomaly',onChange:e=>setAnnotationType(e.target.value),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{children:\"\\uD83E\\uDDE0 LLM+CLIP Anomaly Detection\"})]})]}),(!groundingDinoAvailable||!llmClipAvailable)&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',padding:'10px',backgroundColor:'#fef3c7',border:'1px solid #f59e0b',borderRadius:'4px',fontSize:'14px'},children:[!groundingDinoAvailable&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\u26A0\\uFE0F GroundingDINO not available. Please install dependencies to use AI-powered annotation.\",/*#__PURE__*/_jsx(\"br\",{})]}),!llmClipAvailable&&/*#__PURE__*/_jsxs(_Fragment,{children:[\"\\uD83E\\uDDE0 LLM+CLIP not available. Install transformers and torch, and set OpenAI API key.\",/*#__PURE__*/_jsx(\"br\",{})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'8px',display:'flex',gap:'5px'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:checkGroundingDinoStatus,style:{backgroundColor:'#3b82f6',color:'white',border:'none',padding:'5px 10px',borderRadius:'4px',cursor:'pointer',fontSize:'12px'},children:\"\\uD83D\\uDD04 Check GroundingDINO\"}),/*#__PURE__*/_jsx(\"button\",{onClick:checkLlmClipStatus,style:{backgroundColor:'#8b5cf6',color:'white',border:'none',padding:'5px 10px',borderRadius:'4px',cursor:'pointer',fontSize:'12px'},children:\"\\uD83E\\uDDE0 Check LLM+CLIP\"})]})]})]});const renderGroundingDinoOptions=()=>{if(annotationType!=='grounding-dino-only'&&annotationType!=='grounding-dino-sam2')return null;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px',padding:'20px',backgroundColor:'#f0fdf4',border:'1px solid #10b981',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 15px 0',color:'#059669'},children:annotationType==='grounding-dino-only'?'✨ GroundingDINO Only Settings':'🎭 GroundingDINO + SAM2 Settings'}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Defect Prompts (comma-separated):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:groundingDinoPrompts,onChange:e=>setGroundingDinoPrompts(e.target.value),placeholder:\"e.g., scratch, dent, dirt, corrosion, crack\",style:{width:'100%',padding:'8px',border:'1px solid #d1d5db',borderRadius:'4px',fontSize:'14px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"Describe the defects you want to detect. Be specific (e.g., \\\"scratch on metal surface\\\").\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:[\"Confidence Threshold: \",confidenceThreshold]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.1\",max:\"0.9\",step:\"0.1\",value:confidenceThreshold,onChange:e=>setConfidenceThreshold(parseFloat(e.target.value)),style:{width:'200px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"Lower values detect more objects but may include false positives.\"})]})]});};const renderGuardrailOptions=()=>{if(annotationType!=='guardrail')return null;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px',padding:'20px',backgroundColor:'#faf5ff',border:'1px solid #7c3aed',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 15px 0',color:'#7c3aed'},children:\"\\uD83D\\uDEE1\\uFE0F Guardrail Settings (Anomaly Detection + AI Classification)\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Upload Anomaly Model File:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".ckpt,.pth,.pt\",onChange:e=>setGuardrailModelFile(e.target.files[0]),style:{width:'100%',padding:'8px',border:'1px solid #d1d5db',borderRadius:'4px',fontSize:'14px'}}),guardrailModelFile&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#059669',marginTop:'5px'},children:[\"\\u2705 Selected: \",guardrailModelFile.name]}),/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:[\"Upload your trained PatchCore anomaly detection model (.ckpt file).\",/*#__PURE__*/_jsx(\"br\",{}),\"\\uD83D\\uDCA1 Train one in the \",/*#__PURE__*/_jsx(\"strong\",{children:\"Train\"}),\" page first!\"]})]}),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'15px',padding:'10px',backgroundColor:'#e0e7ff',border:'1px solid #6366f1',borderRadius:'6px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#4f46e5'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\uD83D\\uDCDA Need to train an anomaly model?\"}),/*#__PURE__*/_jsx(\"br\",{}),\"Go to the \",/*#__PURE__*/_jsx(\"strong\",{children:\"Train\"}),\" page to create a new anomaly detection model using defect-free images.\"]})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Classification Prompts (comma-separated):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:guardrailPrompts,onChange:e=>setGuardrailPrompts(e.target.value),placeholder:\"e.g., scratch, dent, dirt, corrosion, crack\",style:{width:'100%',padding:'8px',border:'1px solid #d1d5db',borderRadius:'4px',fontSize:'14px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"After detecting anomalies, the system will use GroundingDINO to classify them with these prompts.\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:[\"Classification Confidence Threshold: \",guardrailConfidenceThreshold]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.1\",max:\"0.9\",step:\"0.1\",value:guardrailConfidenceThreshold,onChange:e=>setGuardrailConfidenceThreshold(parseFloat(e.target.value)),style:{width:'200px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"Confidence threshold for GroundingDINO classification of detected anomalies.\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'10px',backgroundColor:'#e0e7ff',border:'1px solid #3b82f6',borderRadius:'4px',fontSize:'12px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"How Guardrail Works:\"}),/*#__PURE__*/_jsxs(\"ol\",{style:{margin:'5px 0',paddingLeft:'20px'},children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Anomaly Detection:\"}),\" PatchCore detects deviations from \\\"normal\\\" (high sensitivity)\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Classification:\"}),\" GroundingDINO classifies detected anomalies using your prompts\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Result:\"}),\" Only real defects are labeled, with minimal false positives\"]})]})]})]});};const renderLlmClipOptions=()=>{if(annotationType!=='llm-clip-anomaly')return null;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px',padding:'20px',backgroundColor:'#f8fafc',border:'1px solid #8b5cf6',borderRadius:'8px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 15px 0',color:'#8b5cf6'},children:\"\\uD83E\\uDDE0 LLM+CLIP Anomaly Detection Settings\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Component Type:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:componentType,onChange:e=>setComponentType(e.target.value),placeholder:\"e.g., metal plate, circuit board, automotive part\",style:{width:'100%',padding:'8px',border:'1px solid #d1d5db',borderRadius:'4px',fontSize:'14px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"What type of component/object are you analyzing for defects?\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Context/Industry:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:componentContext,onChange:e=>setComponentContext(e.target.value),placeholder:\"e.g., automotive, electronics, manufacturing\",style:{width:'100%',padding:'8px',border:'1px solid #d1d5db',borderRadius:'4px',fontSize:'14px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:\"Additional context to help generate better anomaly descriptions.\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'flex',alignItems:'center'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",checked:useLLM,onChange:e=>setUseLLM(e.target.checked),style:{marginRight:'8px'}}),/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:'bold'},children:\"Use LLM for Description Generation\"})]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280',marginTop:'5px'},children:useLLM?\"🤖 LLM will generate detailed anomaly descriptions (requires OpenAI API key)\":\"📋 Use predefined template descriptions (faster, no API key needed)\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'15px',marginBottom:'15px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:[\"Detection Confidence: \",confidenceThreshold]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.1\",max:\"0.9\",step:\"0.1\",value:confidenceThreshold,onChange:e=>setConfidenceThreshold(parseFloat(e.target.value)),style:{width:'100%'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280'},children:\"GroundingDINO component detection threshold\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:[\"Similarity Threshold: \",similarityThreshold]}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",min:\"0.3\",max:\"0.9\",step:\"0.1\",value:similarityThreshold,onChange:e=>setSimilarityThreshold(parseFloat(e.target.value)),style:{width:'100%'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#6b7280'},children:\"CLIP similarity threshold for anomaly detection\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{padding:'10px',backgroundColor:'#e0e7ff',border:'1px solid #8b5cf6',borderRadius:'4px',fontSize:'12px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"How LLM+CLIP Works:\"}),/*#__PURE__*/_jsxs(\"ol\",{style:{margin:'5px 0',paddingLeft:'20px'},children:[/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"LLM Generation:\"}),\" Creates detailed normal/anomaly descriptions for your component\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Component Localization:\"}),\" GroundingDINO finds component instances in the image\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"CLIP Analysis:\"}),\" Measures semantic similarity between image regions and descriptions\"]}),/*#__PURE__*/_jsxs(\"li\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Anomaly Detection:\"}),\" Regions with low similarity to normal descriptions are flagged as anomalies\"]})]})]}),useLLM&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',padding:'8px',backgroundColor:'#fef3c7',border:'1px solid #f59e0b',borderRadius:'4px',fontSize:'12px'},children:[\"\\uD83D\\uDCA1 \",/*#__PURE__*/_jsx(\"strong\",{children:\"Note:\"}),\" LLM mode requires an OpenAI API key to be set in the backend environment.\"]})]});};const renderResults=()=>{if(annotatedResults.length===0)return null;const successfulResults=annotatedResults.filter(result=>result.success);const failedResults=annotatedResults.filter(result=>!result.success);return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'30px'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCCA Annotation Results\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:'10px'},children:[successfulResults.length>0&&/*#__PURE__*/_jsx(\"button\",{onClick:handleDownloadZip,style:{backgroundColor:'#059669',color:'white',padding:'8px 16px',border:'none',borderRadius:'4px',cursor:'pointer'},children:\"\\uD83D\\uDCE5 Download ZIP\"}),(annotationType==='grounding-dino-only'||annotationType==='grounding-dino-sam2')&&successfulResults.some(r=>r.yolo_annotations)&&/*#__PURE__*/_jsx(\"button\",{onClick:handleExportYoloDataset,style:{backgroundColor:'#7c3aed',color:'white',padding:'8px 16px',border:'none',borderRadius:'4px',cursor:'pointer'},children:\"\\uD83D\\uDCE6 Export YOLO Dataset\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(300px, 1fr))',gap:'20px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"div\",{style:{padding:'15px',backgroundColor:'#dcfce7',border:'1px solid #86efac',borderRadius:'8px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'18px',fontWeight:'bold',color:'#059669'},children:[\"\\u2705 Successful: \",successfulResults.length]})}),/*#__PURE__*/_jsx(\"div\",{style:{padding:'15px',backgroundColor:'#fee2e2',border:'1px solid #fca5a5',borderRadius:'8px'},children:/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'18px',fontWeight:'bold',color:'#dc2626'},children:[\"\\u274C Failed: \",failedResults.length]})})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(400px, 1fr))',gap:'20px'},children:annotatedResults.map((result,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e2e8f0',borderRadius:'8px',padding:'15px',backgroundColor:result.success?'#f9fafb':'#fef2f2'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:'0 0 10px 0'},children:result.originalName}),result.success?/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"img\",{src:result.annotatedUrl,alt:\"Annotated \".concat(result.originalName),style:{width:'100%',borderRadius:'4px',marginBottom:'10px'}}),result.anomaly_regions!==undefined&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#6b7280',marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Anomaly Analysis:\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 Component: \",result.component_type]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 Regions analyzed: \",result.total_regions]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 Anomalies found: \",result.anomaly_regions]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 Anomaly rate: \",(result.anomaly_rate*100).toFixed(1),\"%\"]})]}),result.detections&&result.anomaly_regions===undefined&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#6b7280'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Detections:\"}),\" \",result.total_detections||result.detections.length,result.detections.map((detection,idx)=>/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 \",detection.class,\": \",(detection.confidence*100).toFixed(1),\"%\"]},idx))]}),result.detections&&result.anomaly_regions!==undefined&&result.detections.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{fontSize:'14px',color:'#6b7280'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Anomaly Details:\"}),result.detections.map((detection,idx)=>/*#__PURE__*/_jsxs(\"div\",{style:{marginLeft:'10px',fontSize:'12px'},children:[\"\\u2022 Region \",detection.region_index+1,\": \",detection.is_anomaly?'🔴 ANOMALY':'🟢 NORMAL',detection.is_anomaly&&\" (\".concat(detection.anomaly_type,\")\")]},idx))]})]}):/*#__PURE__*/_jsxs(\"div\",{style:{color:'#dc2626'},children:[\"Error: \",result.error]})]},index))})]});};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',maxWidth:'1200px',margin:'0 auto'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83C\\uDFF7\\uFE0F Image Annotation\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'10px',fontSize:'16px',fontWeight:'bold'},children:\"\\uD83D\\uDCC1 Select Images:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\"image/*\",onChange:handleFileChange,style:{padding:'10px',border:'2px dashed #d1d5db',borderRadius:'8px',width:'100%',cursor:'pointer'}}),files.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',fontSize:'14px',color:'#059669'},children:[\"\\u2705 \",files.length,\" image(s) selected\"]})]}),renderAnnotationTypeSelector(),renderGroundingDinoOptions(),renderGuardrailOptions(),renderLlmClipOptions(),/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'30px'},children:/*#__PURE__*/_jsx(\"button\",{onClick:handleAnnotate,disabled:files.length===0||isLoading,style:{backgroundColor:files.length===0||isLoading?'#9ca3af':'#1e3a8a',color:'white',padding:'12px 24px',border:'none',borderRadius:'8px',fontSize:'16px',cursor:files.length===0||isLoading?'not-allowed':'pointer'},children:isLoading?\"\\uD83D\\uDD04 Processing... (\".concat(processingProgress.current,\"/\").concat(processingProgress.total,\")\"):'🚀 Start Annotation'})}),renderResults()]});}export default Annotate;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}