{"ast":null,"code":"import _objectSpread from\"/Users/truonghaidang/Desktop/open-trainer/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function Predict(){const[images,setImages]=useState([]);const[task,setTask]=useState('detection');const[selectedModel,setSelectedModel]=useState('default');const[uploadedModel,setUploadedModel]=useState(null);const[results,setResults]=useState([]);const[availableModels,setAvailableModels]=useState({pretrained:[],trained:[],uploaded:[]});const[message,setMessage]=useState('');const[isProcessing,setIsProcessing]=useState(false);const[batchSummary,setBatchSummary]=useState(null);// Fetch available models on component mount\nuseEffect(()=>{fetchAvailableModels();},[]);const fetchAvailableModels=async()=>{try{const response=await axios.get('/list-models');setAvailableModels(response.data);}catch(error){console.error('Error fetching models:',error);}};const handleImageUpload=e=>{const files=Array.from(e.target.files);setImages(files);setResults([]);// Clear previous results\nsetBatchSummary(null);};const handleModelUpload=async()=>{if(!uploadedModel){setMessage('Please select a model file to upload.');return;}const formData=new FormData();formData.append('file',uploadedModel);formData.append('model_type',task);try{const response=await axios.post('/upload-model',formData);setMessage(\"Model uploaded successfully: \".concat(response.data.filename));fetchAvailableModels();// Refresh model list\nsetUploadedModel(null);}catch(error){setMessage('Error uploading model.');console.error(error);}};const handlePredict=async()=>{if(images.length===0){setMessage('Please select one or more images.');return;}setIsProcessing(true);setMessage('Processing images...');setResults([]);try{if(images.length===1){// Single image prediction\nawait handleSinglePrediction();}else{// Batch prediction\nawait handleBatchPrediction();}}catch(error){setMessage('Error making prediction.');console.error(error);}finally{setIsProcessing(false);}};const handleSinglePrediction=async()=>{const formData=new FormData();formData.append('file',images[0]);if(selectedModel!=='default'){formData.append('model_path',selectedModel);}const endpoint=task==='detection'?'/predict-detect':'/predict-seg';try{var _response$headers$con;const response=await axios.post(endpoint,formData);if((_response$headers$con=response.headers['content-type'])!==null&&_response$headers$con!==void 0&&_response$headers$con.includes('application/json')){// JSON response with quality assessment\nconst result=response.data;result.filename=images[0].name;setResults([result]);setMessage(\"Prediction complete. Quality: \".concat(result.quality.status));}else{// File response (legacy mode)\nconst imageUrl=URL.createObjectURL(response.data);setResults([{filename:images[0].name,image_url:imageUrl,quality:{status:'Unknown',reason:'Legacy prediction mode'}}]);setMessage('Prediction complete (legacy mode).');}}catch(error){throw error;}};const handleBatchPrediction=async()=>{const formData=new FormData();images.forEach(image=>{formData.append('files',image);});if(selectedModel!=='default'){formData.append('model_path',selectedModel);}formData.append('task_type',task);try{const response=await axios.post('/predict-batch',formData);const data=response.data;setResults(data.results);setBatchSummary(data.summary);setMessage(\"Batch prediction complete. \".concat(data.summary.ok_count,\" OK, \").concat(data.summary.ng_count,\" NG\"));}catch(error){throw error;}};const renderModelSelection=()=>{const allModels=[...availableModels.pretrained.map(m=>_objectSpread(_objectSpread({},m),{},{category:'Pre-trained'})),...availableModels.trained.map(m=>_objectSpread(_objectSpread({},m),{},{category:'Trained'})),...availableModels.uploaded.map(m=>_objectSpread(_objectSpread({},m),{},{category:'Uploaded'}))];return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Model Selection:\"}),/*#__PURE__*/_jsxs(\"select\",{value:selectedModel,onChange:e=>setSelectedModel(e.target.value),disabled:isProcessing,style:{padding:'8px',width:'300px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"default\",children:\"\\uD83E\\uDD16 Default Model\"}),allModels.map((model,index)=>/*#__PURE__*/_jsxs(\"option\",{value:model.path,children:[\"[\",model.category,\"] \",model.name]},index))]}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#666',marginTop:'5px'},children:\"Select a model or use default. Upload new models below.\"})]});};const renderQualityBadge=quality=>{const isOK=quality.status==='OK';return/*#__PURE__*/_jsxs(\"span\",{style:{padding:'4px 8px',borderRadius:'12px',fontSize:'12px',fontWeight:'bold',backgroundColor:isOK?'#dcfce7':'#fee2e2',color:isOK?'#059669':'#dc2626',border:\"1px solid \".concat(isOK?'#86efac':'#fca5a5')},children:[quality.status,\" (\",Math.round(quality.confidence*100),\"%)\"]});};const renderResults=()=>{if(results.length===0)return null;return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDD0D Prediction Results\"}),batchSummary&&/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#f0fdf4',border:'1px solid #059669',borderRadius:'8px',padding:'15px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h4\",{children:\"\\uD83D\\uDCCA Batch Summary\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gridTemplateColumns:'repeat(auto-fit, minmax(150px, 1fr))',gap:'10px'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Total Images:\"}),\" \",batchSummary.total_images]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u2705 OK:\"}),\" \",batchSummary.ok_count,\" (\",batchSummary.ok_percentage.toFixed(1),\"%)\"]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"\\u274C NG:\"}),\" \",batchSummary.ng_count,\" (\",batchSummary.ng_percentage.toFixed(1),\"%)\"]})]})]}),/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gap:'20px'},children:results.map((result,index)=>/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e2e8f0',borderRadius:'8px',padding:'15px',backgroundColor:'white'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"h4\",{style:{margin:0},children:result.filename}),result.quality&&renderQualityBadge(result.quality)]}),result.image_base64&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'15px'},children:/*#__PURE__*/_jsx(\"img\",{src:\"data:image/jpeg;base64,\".concat(result.image_base64),alt:\"Prediction result\",style:{maxWidth:'100%',maxHeight:'400px',borderRadius:'4px',border:'1px solid #e2e8f0'}})}),result.image_url&&/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'15px'},children:/*#__PURE__*/_jsx(\"img\",{src:result.image_url,alt:\"Prediction result\",style:{maxWidth:'100%',maxHeight:'400px',borderRadius:'4px',border:'1px solid #e2e8f0'}})}),result.quality&&/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'10px'},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Quality Assessment:\"}),\" \",result.quality.reason]}),result.detections&&result.detections.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Detections Found:\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'5px'},children:result.detections.map((detection,idx)=>/*#__PURE__*/_jsxs(\"div\",{style:{padding:'5px',backgroundColor:'#f8fafc',margin:'2px 0',borderRadius:'4px',fontSize:'14px'},children:[detection.class,\": \",(detection.confidence*100).toFixed(1),\"%\",detection.area&&\" (Area: \".concat(detection.area,\"px)\")]},idx))})]}),result.total_defects!==undefined&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'10px',fontSize:'14px',color:'#666'},children:[\"Total defects detected: \",result.total_defects]})]},index))})]});};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'20px',maxWidth:'1200px'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDD2E Model Prediction & Quality Assessment\"}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#f8fafc',border:'1px solid #e2e8f0',borderRadius:'8px',padding:'20px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Upload & Predict\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Images:\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",multiple:true,accept:\"image/*\",onChange:handleImageUpload,disabled:isProcessing,style:{padding:'8px',width:'300px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#666',marginTop:'5px'},children:\"Select one or multiple images for prediction. Supports batch processing.\"}),images.length>0&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'5px',fontSize:'14px',color:'#059669'},children:[\"\\u2705 \",images.length,\" image(s) selected\"]})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Task Type:\"}),/*#__PURE__*/_jsxs(\"select\",{value:task,onChange:e=>setTask(e.target.value),disabled:isProcessing,style:{padding:'8px',width:'200px'},children:[/*#__PURE__*/_jsx(\"option\",{value:\"detection\",children:\"\\uD83C\\uDFAF Object Detection\"}),/*#__PURE__*/_jsx(\"option\",{value:\"segmentation\",children:\"\\u2702\\uFE0F Image Segmentation\"})]})]}),renderModelSelection(),/*#__PURE__*/_jsx(\"button\",{onClick:handlePredict,disabled:!images.length||isProcessing,style:{backgroundColor:!images.length||isProcessing?'#ccc':'#1e3a8a',color:'white',padding:'12px 24px',border:'none',borderRadius:'6px',cursor:!images.length||isProcessing?'not-allowed':'pointer',fontSize:'16px'},children:isProcessing?'🔄 Processing...':'🚀 Run Prediction'}),message&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:'10px',padding:'10px',backgroundColor:message.includes('Error')?'#fee2e2':'#dcfce7',border:\"1px solid \".concat(message.includes('Error')?'#fca5a5':'#86efac'),borderRadius:'4px',color:message.includes('Error')?'#dc2626':'#059669'},children:message})]}),/*#__PURE__*/_jsxs(\"div\",{style:{backgroundColor:'#fffbeb',border:'1px solid #f59e0b',borderRadius:'8px',padding:'20px',marginBottom:'20px'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"\\uD83D\\uDCE4 Upload Custom Model\"}),/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'15px'},children:[/*#__PURE__*/_jsx(\"label\",{style:{display:'block',marginBottom:'5px',fontWeight:'bold'},children:\"Model File (.pt):\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",accept:\".pt\",onChange:e=>setUploadedModel(e.target.files[0]),style:{padding:'8px',width:'300px'}}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:'12px',color:'#666',marginTop:'5px'},children:\"Upload your trained YOLO model (.pt file)\"})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleModelUpload,disabled:!uploadedModel,style:{backgroundColor:!uploadedModel?'#ccc':'#f59e0b',color:'white',padding:'8px 16px',border:'none',borderRadius:'4px',cursor:!uploadedModel?'not-allowed':'pointer'},children:\"\\uD83D\\uDCE4 Upload Model\"})]}),renderResults()]});}export default Predict;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}