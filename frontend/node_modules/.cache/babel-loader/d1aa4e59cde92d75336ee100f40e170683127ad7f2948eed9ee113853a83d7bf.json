{"ast":null,"code":"import _objectSpread from\"/Users/truonghaidang/Desktop/open-trainer/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useCallback}from'react';import'./ModelTraining.css';import{jsxs as _jsxs,jsx as _jsx}from\"react/jsx-runtime\";function ModelTraining(_ref){let{projectId,projectType,trainingStatus}=_ref;const[trainingParams,setTrainingParams]=useState({epochs:50,batch_size:16,image_size:640,patience:10,// SAM2 specific params\nfew_shot_examples:5,similarity_threshold:0.8,mask_threshold:0.5});const[training,setTraining]=useState(false);const[trainingProgress,setTrainingProgress]=useState({status:trainingStatus||'not_started',progress:0,current_epoch:0,total_epochs:0,metrics:{},logs:[]});const[errors,setErrors]=useState({});const fetchTrainingStatus=useCallback(async()=>{try{const response=await fetch(\"/api/auto-annotation/projects/\".concat(projectId,\"/training-status\"));const data=await response.json();if(data.status==='success'){console.log('Training status update:',data);setTrainingProgress(prev=>_objectSpread(_objectSpread({},prev),{},{status:data.training_status,progress:data.progress,current_epoch:data.current_epoch,total_epochs:data.total_epochs,metrics:data.metrics,logs:data.logs}));}}catch(error){console.error('Failed to fetch training status:',error);}},[projectId]);// Poll training status\nuseEffect(()=>{let interval;if(trainingProgress.status==='running'){interval=setInterval(()=>{fetchTrainingStatus();},2000);}return()=>{if(interval)clearInterval(interval);};},[trainingProgress.status,projectId,fetchTrainingStatus]);const handleParamChange=(param,value)=>{setTrainingParams(prev=>_objectSpread(_objectSpread({},prev),{},{[param]:value}));};const startTraining=async()=>{setTraining(true);setErrors({});try{const formData=new FormData();if(projectType==='object_detection'){formData.append('epochs',trainingParams.epochs);formData.append('batch_size',trainingParams.batch_size);formData.append('image_size',trainingParams.image_size);formData.append('patience',trainingParams.patience);}else{formData.append('few_shot_examples',trainingParams.few_shot_examples);formData.append('similarity_threshold',trainingParams.similarity_threshold);formData.append('mask_threshold',trainingParams.mask_threshold);}const response=await fetch(\"/api/auto-annotation/projects/\".concat(projectId,\"/start-training\"),{method:'POST',body:formData});const result=await response.json();if(result.status==='success'){console.log('Training started successfully:',result);setTrainingProgress(prev=>_objectSpread(_objectSpread({},prev),{},{status:'running',total_epochs:trainingParams.epochs}));}else{console.log('Training start failed:',result);setErrors({training:result.message||'Failed to start training'});}}catch(error){console.error('Training failed:',error);setErrors({training:'Network error. Please try again.'});}finally{setTraining(false);}};const getStatusIcon=status=>{switch(status){case'not_started':return'‚è≥';case'running':return'üöÄ';case'completed':return'‚úÖ';case'failed':return'‚ùå';default:return'‚ö™';}};const getStatusColor=status=>{switch(status){case'not_started':return'#6c757d';case'running':return'#007bff';case'completed':return'#28a745';case'failed':return'#dc3545';default:return'#6c757d';}};const canStartTraining=trainingProgress.status==='not_started'||trainingProgress.status==='failed';return/*#__PURE__*/_jsxs(\"div\",{className:\"model-training\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"training-status\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"status-header\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"status-indicator\",style:{color:getStatusColor(trainingProgress.status)},children:[getStatusIcon(trainingProgress.status),trainingProgress.status.replace('_',' ').toUpperCase()]}),trainingProgress.status==='running'&&/*#__PURE__*/_jsxs(\"span\",{className:\"epoch-info\",children:[\"Epoch \",trainingProgress.current_epoch,\" / \",trainingProgress.total_epochs]})]}),trainingProgress.status==='running'&&/*#__PURE__*/_jsxs(\"div\",{className:\"progress-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"progress-bar\",children:/*#__PURE__*/_jsx(\"div\",{className:\"progress-fill\",style:{width:\"\".concat(Math.max(trainingProgress.progress,2),\"%\")}})}),/*#__PURE__*/_jsx(\"span\",{className:\"progress-text\",children:trainingProgress.progress>0?\"\".concat(trainingProgress.progress,\"%\"):'Starting...'})]})]}),canStartTraining&&/*#__PURE__*/_jsxs(\"div\",{className:\"training-params\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDD27 Training Parameters\"}),projectType==='object_detection'?/*#__PURE__*/_jsxs(\"div\",{className:\"params-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Epochs\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:trainingParams.epochs,onChange:e=>handleParamChange('epochs',parseInt(e.target.value)),min:\"1\",max:\"1000\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Number of training iterations\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Batch Size\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:trainingParams.batch_size,onChange:e=>handleParamChange('batch_size',parseInt(e.target.value)),min:\"1\",max:\"64\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Images processed together\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Image Size\"}),/*#__PURE__*/_jsxs(\"select\",{value:trainingParams.image_size,onChange:e=>handleParamChange('image_size',parseInt(e.target.value)),children:[/*#__PURE__*/_jsx(\"option\",{value:416,children:\"416px\"}),/*#__PURE__*/_jsx(\"option\",{value:512,children:\"512px\"}),/*#__PURE__*/_jsx(\"option\",{value:640,children:\"640px (recommended)\"}),/*#__PURE__*/_jsx(\"option\",{value:800,children:\"800px\"})]}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Input image resolution\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Patience\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:trainingParams.patience,onChange:e=>handleParamChange('patience',parseInt(e.target.value)),min:\"1\",max:\"50\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Early stopping patience\"})]})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"params-grid\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Few-Shot Examples\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:trainingParams.few_shot_examples,onChange:e=>handleParamChange('few_shot_examples',parseInt(e.target.value)),min:\"1\",max:\"20\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Examples per defect class\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Similarity Threshold\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",value:trainingParams.similarity_threshold,onChange:e=>handleParamChange('similarity_threshold',parseFloat(e.target.value)),min:\"0.1\",max:\"1.0\",step:\"0.1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-value\",children:trainingParams.similarity_threshold}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Feature similarity threshold\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"param-item\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Mask Threshold\"}),/*#__PURE__*/_jsx(\"input\",{type:\"range\",value:trainingParams.mask_threshold,onChange:e=>handleParamChange('mask_threshold',parseFloat(e.target.value)),min:\"0.1\",max:\"1.0\",step:\"0.1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"param-value\",children:trainingParams.mask_threshold}),/*#__PURE__*/_jsx(\"span\",{className:\"param-help\",children:\"Mask confidence threshold\"})]})]})]}),trainingProgress.status==='running'&&Object.keys(trainingProgress.metrics).length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"training-metrics\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDCCA Training Metrics\"}),/*#__PURE__*/_jsx(\"div\",{className:\"metrics-grid\",children:Object.entries(trainingProgress.metrics).map(_ref2=>{let[key,value]=_ref2;return/*#__PURE__*/_jsxs(\"div\",{className:\"metric-item\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"metric-label\",children:key}),/*#__PURE__*/_jsx(\"span\",{className:\"metric-value\",children:typeof value==='number'?value.toFixed(4):value})]},key);})})]}),trainingProgress.logs&&trainingProgress.logs.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"training-logs\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\uD83D\\uDCDD Training Logs\"}),/*#__PURE__*/_jsx(\"div\",{className:\"logs-container\",children:trainingProgress.logs.slice(-10).map((log,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"log-entry\",children:log},index))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"training-actions\",children:[errors.training&&/*#__PURE__*/_jsxs(\"div\",{className:\"error-banner\",children:[\"\\u274C \",errors.training]}),canStartTraining&&/*#__PURE__*/_jsx(\"button\",{className:\"start-training-button\",onClick:startTraining,disabled:training,children:training?'‚è≥ Starting...':\"\\uD83D\\uDE80 Start \".concat(projectType==='object_detection'?'YOLO':'SAM2',\" Training\")}),trainingProgress.status==='completed'&&/*#__PURE__*/_jsx(\"div\",{className:\"success-banner\",children:\"\\u2705 Model training completed successfully! Ready for auto-annotation.\"}),trainingProgress.status==='failed'&&/*#__PURE__*/_jsx(\"div\",{className:\"error-banner\",children:\"\\u274C Training failed. Please check your data and try again.\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"training-info\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"\\u2139\\uFE0F Training Process\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-steps\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"info-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"1\"}),/*#__PURE__*/_jsx(\"span\",{className:\"step-text\",children:\"Data preparation and validation\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"2\"}),/*#__PURE__*/_jsx(\"span\",{className:\"step-text\",children:projectType==='object_detection'?'YOLO model training with your annotations':'SAM2 few-shot learning setup'})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"3\"}),/*#__PURE__*/_jsx(\"span\",{className:\"step-text\",children:\"Model evaluation and optimization\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"info-step\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"step-number\",children:\"4\"}),/*#__PURE__*/_jsx(\"span\",{className:\"step-text\",children:\"Model ready for automatic annotation\"})]})]})]})]});}export default ModelTraining;","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}